<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/nextgen-adsdk-android-release/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/nextgen-adsdk-android-release/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul:nth-of-type(1) > li > ul > li:not(:nth-child(10)) > a, .site-nav > ul:nth-of-type(1) > li > ul > li > ul > li a { background-image: none; } .site-nav > ul:not(:nth-of-type(1)) a, .site-nav li.external a { background-image: none; } .site-nav > ul:nth-of-type(1) > li > ul > li:nth-child(10) > a { font-weight: 600; text-decoration: none; } .site-nav > ul.nav-category-list > li > button svg, .site-nav > ul:nth-of-type(1) > li > ul > li:nth-child(10) > button svg { transform: rotate(-90deg); } .site-nav > ul.nav-category-list > li.nav-list-item > ul.nav-list, .site-nav > ul:nth-of-type(1) > li > ul > li.nav-list-item:nth-child(10) > ul.nav-list { display: block; } </style> <script src="/nextgen-adsdk-android-release/assets/js/vendor/lunr.min.js"></script> <script src="/nextgen-adsdk-android-release/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Creating customised advertising | AdSDK Documentation</title> <meta name="generator" content="Jekyll v3.10.0" /> <meta property="og:title" content="Creating customised advertising" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Creating customised advertising" /> <meta property="og:description" content="Creating customised advertising" /> <link rel="canonical" href="https://vm-mobile-sdk.github.io/nextgen-adsdk-android-release/6.0.0/creating-customised-advertising.html" /> <meta property="og:url" content="https://vm-mobile-sdk.github.io/nextgen-adsdk-android-release/6.0.0/creating-customised-advertising.html" /> <meta property="og:site_name" content="AdSDK Documentation" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Creating customised advertising" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Creating customised advertising","headline":"Creating customised advertising","url":"https://vm-mobile-sdk.github.io/nextgen-adsdk-android-release/6.0.0/creating-customised-advertising.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/nextgen-adsdk-android-release/" class="site-title lh-tight"> AdSDK Documentation </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list nav-category-list"> <li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Toggle collection SDK v.6.0.0" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><div class="nav-category">SDK v.6.0.0</div> <ul class="nav-list"><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/meet-adsdk.html" class="nav-list-link">Meet nextgen AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/first-steps.html" class="nav-list-link">First steps for working with AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/create-and-display-inline-ads.html" class="nav-list-link">Create and display inline ads</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/create-and-display-interstitial-ad.html" class="nav-list-link">Create and display interstitial ad</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/handling-the-ad-events.html" class="nav-list-link">Handling the ad events</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/user-tagging-conversion-tracking.html" class="nav-list-link">User tagging and conversion tracking</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/global-request-parameters.html" class="nav-list-link">Global request parameters</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/cache-management.html" class="nav-list-link">AdSDK Cache Management</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/create-target-url-handler.html" class="nav-list-link">Custom handling of target tap URLs</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/creating-customised-advertising.html" class="nav-list-link">Creating customised advertising</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/compose_with_xml_guide.html" class="nav-list-link">How to use AdSDK with XML views</a></li></ul> </li> </ul> <ul class="nav-list nav-category-list"> <li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Toggle collection SDK v.5.3.0" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><div class="nav-category">SDK v.5.3.0</div> <ul class="nav-list"><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/meet-adsdk.html" class="nav-list-link">Meet nextgen AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/first-steps.html" class="nav-list-link">First steps for working with AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/create-and-display-inline-ads.html" class="nav-list-link">Create and display inline ads</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/create-and-display-interstitial-ad.html" class="nav-list-link">Create and display interstitial ad</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/handling-the-ad-events.html" class="nav-list-link">Handling the ad events</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/user-tagging-conversion-tracking.html" class="nav-list-link">User tagging and conversion tracking</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/global-request-parameters.html" class="nav-list-link">Global request parameters</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/cache-management.html" class="nav-list-link">AdSDK Cache Management</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/creating-customised-advertising.html" class="nav-list-link">Creating customised advertising</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/compose_with_xml_guide.html" class="nav-list-link">How to use AdSDK with XML views</a></li></ul> </li> </ul> <ul class="nav-list nav-category-list"> <li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Toggle collection SDK v.5.0.1" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><div class="nav-category">SDK v.5.0.1</div> <ul class="nav-list"><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/meet-adsdk.html" class="nav-list-link">Meet nextgen AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/first-steps.html" class="nav-list-link">First steps for working with AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/create-and-display-inline-ads.html" class="nav-list-link">Create and display inline ads</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/create-and-display-interstitial-ad.html" class="nav-list-link">Create and display interstitial ad</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/handling-the-ad-events.html" class="nav-list-link">Handling the ad events</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/user-tagging-conversion-tracking.html" class="nav-list-link">User tagging and conversion tracking</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/global-request-parameters.html" class="nav-list-link">Global request parameters</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/cache-management.html" class="nav-list-link">AdSDK Cache Management</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/creating-customised-advertising.html" class="nav-list-link">Creating customised advertising</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/compose_with_xml_guide.html" class="nav-list-link">How to use AdSDK with XML views</a></li></ul> </li> </ul> <ul class="nav-list nav-category-list"> <li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Toggle collection SDK v.5.0.0" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><div class="nav-category">SDK v.5.0.0</div> <ul class="nav-list"><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.0/meet-adsdk.html" class="nav-list-link">Meet nextgen AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.0/first-steps.html" class="nav-list-link">First steps for working with AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.0/create-and-display-inline-ads.html" class="nav-list-link">Create and display inline ads</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.0/create-and-display-interstitial-ad.html" class="nav-list-link">Create and display interstitial ad</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.0/handling-the-ad-events.html" class="nav-list-link">Handling the ad events</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.0/user-tagging-conversion-tracking.html" class="nav-list-link">User tagging and conversion tracking</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.0/global-request-parameters.html" class="nav-list-link">Global request parameters</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.0/cache-management.html" class="nav-list-link">AdSDK Cache Management</a></li></ul> </li> </ul> <ul class="nav-list nav-category-list"> <li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Toggle collection SDK v.4.6.0" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><div class="nav-category">SDK v.4.6.0</div> <ul class="nav-list"><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/4.6.0/meet-adsdk.html" class="nav-list-link">Meet nextgen AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/4.6.0/create-and-display-inline-ads.html" class="nav-list-link">Create and display inline ads</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/4.6.0/handling-the-state-and-events-of-advertising.html" class="nav-list-link">Handling the state and events of advertising</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/4.6.0/defining-the-size-of-the-advertisement.html" class="nav-list-link">Defining the size of the advertisement</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/4.6.0/create-and-display-interstitial-ad-section.html" class="nav-list-link">Create and display interstitial ad section</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/4.6.0/global-adRequest-parameters.html" class="nav-list-link">Global ad request parameters</a></li></ul> </li> </ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search AdSDK Documentation" aria-label="Search AdSDK Documentation" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <h1 id="creating-customised-advertising"> <a href="#creating-customised-advertising" class="anchor-heading" aria-labelledby="creating-customised-advertising"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Creating customised advertising </h1> <p>In this tutorial, we will learn how to create custom ads using AdSDK. This process is the same for both inline and interstitial ads.</p> <p>We will continue to build the app, so be sure to follow all the previous tutorials. You can download this <a href="https://github.com/VM-Mobile-SDK/nextgen-adsdk-android-tutorial/tree/extending-sdk/creating-customised-ad">project</a> which has already implemented all steps from this tutorial.</p> <p><strong>Note:</strong> In this tutorial, we want to display a picture and frame it, but in real-world projects, your ad can be anything - video, HTML, graphics, etc.</p> <h2 id="section-1-preparing-the-app"> <a href="#section-1-preparing-the-app" class="anchor-heading" aria-labelledby="section-1-preparing-the-app"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Section 1: Preparing the app </h2> <p>In this section, we will prepare our project for creating a custom renderer. We will create the logic for decoding the future JSON and move the methods for working with <a href="ad_sdk/com.adition.ad_sdk.api.entities.exception/-ad-result/index.html">AdResult</a> to a separate file.</p> <h3 id="step-1"> <a href="#step-1" class="anchor-heading" aria-labelledby="step-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1 </h3> <p>The server should always be configured to return a custom response when using custom advertising. In this tutorial, the server is configured to give us the following response.</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="err">//</span><span class="w"> </span><span class="err">...</span><span class="w">
    </span><span class="err">ad_name:</span><span class="w"> </span><span class="s2">"tutorialad"</span><span class="p">,</span><span class="w">
    </span><span class="err">body:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">//</span><span class="w"> </span><span class="err">...</span><span class="w">
        </span><span class="err">ext:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="err">//</span><span class="w"> </span><span class="err">...</span><span class="w">
            </span><span class="err">adData:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="err">banner_image:</span><span class="w"> </span><span class="err">Banner</span><span class="w"> </span><span class="err">URL</span><span class="p">,</span><span class="w">
                </span><span class="err">framing_width:</span><span class="w"> </span><span class="err">Framing</span><span class="w"> </span><span class="err">width</span><span class="p">,</span><span class="w">
                </span><span class="err">is_black_framing:</span><span class="w"> </span><span class="err">Boolean</span><span class="w"> </span><span class="err">value</span><span class="w"> </span><span class="err">–</span><span class="w"> </span><span class="err">whether</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">color</span><span class="w"> </span><span class="err">should</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">black</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">white.</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <h3 id="step-2"> <a href="#step-2" class="anchor-heading" aria-labelledby="step-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2 </h3> <p>Knowing the data we want to obtain, we can start with the logic of decoding JSON. To do this, create <code class="language-plaintext highlighter-rouge">TutorialRendererResponse.kt</code> in the <code class="language-plaintext highlighter-rouge">ui/components/tutorial_renderer</code> package.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">TutorialRendererResponse.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Serializable</span>
<span class="kd">data class</span> <span class="nc">TutorialRendererResponse</span><span class="p">(</span><span class="kd">val</span> <span class="py">body</span><span class="p">:</span> <span class="nc">Body</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">bannerImage</span><span class="p">:</span> <span class="nc">String</span>
        <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">body</span><span class="p">.</span><span class="n">ext</span><span class="p">.</span><span class="n">adData</span><span class="p">.</span><span class="n">bannerImage</span>
    
    <span class="kd">val</span> <span class="py">framingWidth</span><span class="p">:</span> <span class="nc">Double</span>
        <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">body</span><span class="p">.</span><span class="n">ext</span><span class="p">.</span><span class="n">adData</span><span class="p">.</span><span class="n">framingWidth</span>
    
    <span class="kd">val</span> <span class="py">isBlackFraming</span><span class="p">:</span> <span class="nc">Boolean</span>
        <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">body</span><span class="p">.</span><span class="n">ext</span><span class="p">.</span><span class="n">adData</span><span class="p">.</span><span class="n">isBlackFraming</span>

    <span class="nd">@Serializable</span>
    <span class="kd">data class</span> <span class="nc">Body</span><span class="p">(</span><span class="kd">val</span> <span class="py">ext</span><span class="p">:</span> <span class="nc">Ext</span><span class="p">)</span>

    <span class="nd">@Serializable</span>
    <span class="kd">data class</span> <span class="nc">Ext</span><span class="p">(</span><span class="kd">val</span> <span class="py">adData</span><span class="p">:</span> <span class="nc">AdData</span><span class="p">)</span>

    <span class="nd">@Serializable</span>
    <span class="kd">data class</span> <span class="nc">AdData</span><span class="p">(</span>
        <span class="nd">@SerialName</span><span class="p">(</span><span class="s">"banner_image"</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">bannerImage</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="nd">@SerialName</span><span class="p">(</span><span class="s">"framing_width"</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">framingWidth</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
        <span class="nd">@SerialName</span><span class="p">(</span><span class="s">"is_black_framing"</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">isBlackFraming</span><span class="p">:</span> <span class="nc">Boolean</span>
    <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-3"> <a href="#step-3" class="anchor-heading" aria-labelledby="step-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 3 </h3> <p>Since the renderer is an extension to the SDK, it should also work with the <a href="ad_sdk/com.adition.ad_sdk.api.entities.exception/-ad-result/index.html">AdResult</a>. Create a <code class="language-plaintext highlighter-rouge">JsonExtensions.kt</code> file in the <code class="language-plaintext highlighter-rouge">utility/</code> package. In it, we implement a method for decoding JSON, which returns the <a href="ad_sdk/com.adition.ad_sdk.api.entities.exception/-ad-result/index.html">AdResult</a> type.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">JsonExtensions.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">inline</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="k">reified</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="nc">Json</span><span class="p">.</span><span class="nf">decodeString</span><span class="p">(</span><span class="n">json</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">=</span> <span class="k">try</span> <span class="p">{</span>
    <span class="nc">AdResult</span><span class="p">.</span><span class="nc">Success</span><span class="p">(</span><span class="n">decodeFromString</span><span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;(</span><span class="n">json</span><span class="p">))</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">exception</span><span class="p">:</span> <span class="nc">SerializationException</span><span class="p">)</span> <span class="p">{</span>
    <span class="nc">AdResult</span><span class="p">.</span><span class="nc">Error</span><span class="p">(</span><span class="nc">AdError</span><span class="p">.</span><span class="nc">Decoding</span><span class="p">(</span><span class="n">exception</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-4"> <a href="#step-4" class="anchor-heading" aria-labelledby="step-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 4 </h3> <p>The next step is to create <code class="language-plaintext highlighter-rouge">ByteArrayExtensions.kt</code> in the same package. In this file, we implement the logic for converting <code class="language-plaintext highlighter-rouge">ByteArray</code> to <code class="language-plaintext highlighter-rouge">ImageBitmap</code>.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">ByteArrayExtensions.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fun</span> <span class="nc">ByteArray</span><span class="p">.</span><span class="nf">toImageBitmap</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">AdResult</span><span class="p">&lt;</span><span class="nc">ImageBitmap</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">image</span> <span class="p">=</span> <span class="nf">runCatching</span> <span class="p">{</span>
        <span class="nc">BitmapFactory</span><span class="p">.</span><span class="nf">decodeByteArray</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">size</span><span class="p">)</span><span class="o">?.</span><span class="nf">asImageBitmap</span><span class="p">()</span>
    <span class="p">}.</span><span class="nf">getOrNull</span><span class="p">()</span>

    <span class="k">return</span> <span class="k">if</span> <span class="p">(</span><span class="n">image</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nc">AdResult</span><span class="p">.</span><span class="nc">Success</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">exception</span> <span class="p">=</span> <span class="nc">JSONException</span><span class="p">(</span><span class="s">"Image bitmap decoding failed for URL: $url"</span><span class="p">)</span>
        <span class="nc">AdResult</span><span class="p">.</span><span class="nc">Error</span><span class="p">(</span><span class="nc">AdError</span><span class="p">.</span><span class="nc">Decoding</span><span class="p">(</span><span class="n">exception</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-5"> <a href="#step-5" class="anchor-heading" aria-labelledby="step-5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 5 </h3> <p>The final step of preparation is to transfer all <a href="ad_sdk/com.adition.ad_sdk.api.entities.exception/-ad-result/index.html">AdResult</a>’s extensions methods from <code class="language-plaintext highlighter-rouge">MainScreen.kt</code> and <code class="language-plaintext highlighter-rouge">AdItem.kt</code> to a separate file <code class="language-plaintext highlighter-rouge">AdResultExtensions.kt</code>, which we create in the <code class="language-plaintext highlighter-rouge">utility/</code> package.</p> <p>We do this because when creating a renderer, we will have to actively work with <a href="ad_sdk/com.adition.ad_sdk.api.entities.exception/-ad-result/index.html">AdResult</a>.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">AdResultExtensions.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">suspend</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="nc">T</span><span class="p">,</span> <span class="nc">ActionResult</span><span class="p">&gt;</span> <span class="nf">AdResult</span><span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;.</span><span class="nf">map</span><span class="p">(</span>
    <span class="n">action</span><span class="p">:</span> <span class="k">suspend</span> <span class="p">(</span><span class="nc">T</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nc">ActionResult</span>
<span class="p">):</span> <span class="nc">AdResult</span><span class="p">&lt;</span><span class="nc">ActionResult</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">when</span> <span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">is</span> <span class="nc">AdResult</span><span class="p">.</span><span class="nc">Success</span> <span class="p">-&gt;</span> <span class="nc">AdResult</span><span class="p">.</span><span class="nc">Success</span><span class="p">(</span><span class="nf">action</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">result</span><span class="p">))</span>
        <span class="k">is</span> <span class="nc">AdResult</span><span class="p">.</span><span class="nc">Error</span> <span class="p">-&gt;</span> <span class="nc">AdResult</span><span class="p">.</span><span class="nc">Error</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">error</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">suspend</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="nc">T</span><span class="p">,</span> <span class="nc">ActionResult</span><span class="p">&gt;</span> <span class="nf">AdResult</span><span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;.</span><span class="nf">flatMap</span><span class="p">(</span>
    <span class="n">action</span><span class="p">:</span> <span class="k">suspend</span> <span class="p">(</span><span class="nc">T</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nc">AdResult</span><span class="p">&lt;</span><span class="nc">ActionResult</span><span class="p">&gt;</span>
<span class="p">):</span> <span class="nc">AdResult</span><span class="p">&lt;</span><span class="nc">ActionResult</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">when</span> <span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">is</span> <span class="nc">AdResult</span><span class="p">.</span><span class="nc">Success</span> <span class="p">-&gt;</span> <span class="nf">action</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">result</span><span class="p">)</span>
        <span class="k">is</span> <span class="nc">AdResult</span><span class="p">.</span><span class="nc">Error</span> <span class="p">-&gt;</span> <span class="nc">AdResult</span><span class="p">.</span><span class="nc">Error</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">error</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">suspend</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;</span> <span class="nf">AdResult</span><span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;.</span><span class="nf">onSuccess</span><span class="p">(</span>
    <span class="n">action</span><span class="p">:</span> <span class="k">suspend</span> <span class="p">(</span><span class="nc">T</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nc">Unit</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">AdResult</span><span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">when</span> <span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">is</span> <span class="nc">AdResult</span><span class="p">.</span><span class="nc">Success</span> <span class="p">-&gt;</span> <span class="p">{</span>
            <span class="nf">action</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">result</span><span class="p">)</span>
            <span class="k">this</span>
        <span class="p">}</span>
        <span class="k">is</span> <span class="nc">AdResult</span><span class="p">.</span><span class="nc">Error</span> <span class="p">-&gt;</span> <span class="k">this</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="section-2-creating-a-business-layer"> <a href="#section-2-creating-a-business-layer" class="anchor-heading" aria-labelledby="section-2-creating-a-business-layer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Section 2: Creating a business layer </h2> <p>We use the <a href="ad_sdk/com.adition.ad_sdk.api.core/-ad-renderer/index.html">AdRenderer</a> interface to create custom advertisements. In this section, we will look at methods related to the business layer of renderer creation.</p> <h3 id="step-1-1"> <a href="#step-1-1" class="anchor-heading" aria-labelledby="step-1-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1 </h3> <p>Create <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code> in the <code class="language-plaintext highlighter-rouge">ui/components/tutorial_renderer</code> package. In this file, we implement a class that will implement our future <a href="ad_sdk/com.adition.ad_sdk.api.core/-ad-renderer/index.html">AdRenderer</a>.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TutorialRenderer</span> <span class="p">:</span> <span class="nc">AdRenderer</span> <span class="p">{</span>
    
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-2-1"> <a href="#step-2-1" class="anchor-heading" aria-labelledby="step-2-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2 </h3> <p>Let’s start with the <a href="ad_sdk/com.adition.ad_sdk.api.core/-ad-renderer/configure.html">AdRenderer.configure</a> method. This method is the key to creating ads. Within it, you have to perform all the logic to prepare the ad for display - decoding, additional downloads, etc.</p> <p><strong>Note:</strong> This method is directly related to the <a href="ad_sdk/com.adition.ad_sdk.api.core/-ad-service/make-advertisement.html">AdService.makeAdvertisement</a> and <a href="ad_sdk/com.adition.ad_sdk.api.core/-advertisement/reload.html">Advertisement.reload</a> methods. As soon as this method is completed, the <a href="ad_sdk/com.adition.ad_sdk.api.core/-advertisement/index.html">Advertisement</a> will be returned to the app.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TutorialRenderer</span> <span class="p">:</span> <span class="nc">AdRenderer</span> <span class="p">{</span>
    <span class="c1">// Will be called every time an ad is loaded or reloaded.</span>
    <span class="k">override</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">configure</span><span class="p">(</span>
        <span class="n">adResponse</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="n">adMetadata</span><span class="p">:</span> <span class="nc">AdMetadata</span>
    <span class="p">):</span> <span class="nc">AdResult</span><span class="p">&lt;</span><span class="nc">Unit</span><span class="p">&gt;</span> <span class="p">{</span>

    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-3-1"> <a href="#step-3-1" class="anchor-heading" aria-labelledby="step-3-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 3 </h3> <p>The <code class="language-plaintext highlighter-rouge">adResponse</code> parameter contains the entire response from the server.</p> <p>Let’s add the decoding logic to get the data we need to create the ad.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TutorialRenderer</span> <span class="p">:</span> <span class="nc">AdRenderer</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">jsonFormat</span> <span class="p">=</span> <span class="nc">Json</span> <span class="p">{</span> <span class="n">ignoreUnknownKeys</span> <span class="p">=</span> <span class="k">true</span> <span class="p">}</span>

    <span class="c1">// Will be called every time an ad is loaded or reloaded.</span>
    <span class="k">override</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">configure</span><span class="p">(</span>
        <span class="n">adResponse</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="n">adMetadata</span><span class="p">:</span> <span class="nc">AdMetadata</span>
    <span class="p">)</span> <span class="p">=</span> <span class="n">jsonFormat</span><span class="p">.</span><span class="n">decodeString</span><span class="p">&lt;</span><span class="nc">TutorialRendererResponse</span><span class="p">&gt;(</span><span class="n">adResponse</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-4-1"> <a href="#step-4-1" class="anchor-heading" aria-labelledby="step-4-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 4 </h3> <p>The next step is to load a banner for display. The SDK provides some tools for easy work with advertising resources. In this case, we use <a href="ad_sdk/com.adition.ad_sdk.api.services.asset_repository/-asset-repository/index.html">AssetRepository</a>. We pass it through the constructor.</p> <p>It can download, cache, and return cached advertising resources. When using it, we don’t need to think about caching, as the whole process takes place internally. Isn’t it convenient?</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TutorialRenderer</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">assetRepository</span><span class="p">:</span> <span class="nc">AssetRepository</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">AdRenderer</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">jsonFormat</span> <span class="p">=</span> <span class="nc">Json</span> <span class="p">{</span> <span class="n">ignoreUnknownKeys</span> <span class="p">=</span> <span class="k">true</span> <span class="p">}</span>

    <span class="c1">// Will be called every time an ad is loaded or reloaded.</span>
    <span class="k">override</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">configure</span><span class="p">(</span>
        <span class="n">adResponse</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="n">adMetadata</span><span class="p">:</span> <span class="nc">AdMetadata</span>
    <span class="p">)</span> <span class="p">=</span> <span class="n">jsonFormat</span><span class="p">.</span><span class="n">decodeString</span><span class="p">&lt;</span><span class="nc">TutorialRendererResponse</span><span class="p">&gt;(</span><span class="n">adResponse</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-5-1"> <a href="#step-5-1" class="anchor-heading" aria-labelledby="step-5-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 5 </h3> <p>We use the <a href="ad_sdk/com.adition.ad_sdk.api.services.asset_repository/-asset-repository/get-asset.html">AssetRepository.getAsset</a> method, which can return either <a href="ad_sdk/com.adition.ad_sdk.api.entities.exception/-ad-error/index.html">AdError</a> or <a href="ad_sdk/com.adition.ad_sdk.api.services.asset_repository/-asset-result/index.html">AssetResult</a>.</p> <p>From it, we can get the loaded data and find out whether it was successfully cached.</p> <p><strong>Note:</strong> You can also use <a href="ad_sdk/com.adition.ad_sdk.api.services.asset_repository/-asset-repository/get-assets.html">AssetRepository.getAssets</a> to load multiple advertising resources concurrently.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TutorialRenderer</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">assetRepository</span><span class="p">:</span> <span class="nc">AssetRepository</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">AdRenderer</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">jsonFormat</span> <span class="p">=</span> <span class="nc">Json</span> <span class="p">{</span> <span class="n">ignoreUnknownKeys</span> <span class="p">=</span> <span class="k">true</span> <span class="p">}</span>

    <span class="c1">// Will be called every time an ad is loaded or reloaded.</span>
    <span class="k">override</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">configure</span><span class="p">(</span>
        <span class="n">adResponse</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="n">adMetadata</span><span class="p">:</span> <span class="nc">AdMetadata</span>
    <span class="p">)</span> <span class="p">=</span> <span class="n">jsonFormat</span><span class="p">.</span><span class="n">decodeString</span><span class="p">&lt;</span><span class="nc">TutorialRendererResponse</span><span class="p">&gt;(</span><span class="n">adResponse</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">flatMap</span> <span class="p">{</span> <span class="n">response</span> <span class="p">-&gt;</span>
            <span class="n">assetRepository</span>
                <span class="p">.</span><span class="nf">getAsset</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">bannerImage</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">onSuccess</span> <span class="p">{</span> <span class="n">assetResult</span> <span class="p">-&gt;</span>
                    <span class="n">assetResult</span><span class="p">.</span><span class="n">cacheResult</span><span class="p">.</span><span class="k">get</span><span class="p">(</span>
                        <span class="n">onSuccess</span> <span class="p">=</span> <span class="p">{</span>
                            <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"TutorialRenderer"</span><span class="p">,</span> <span class="s">"Banner cached: $it"</span><span class="p">)</span>
                        <span class="p">},</span>
                        <span class="n">onError</span> <span class="p">=</span> <span class="p">{</span>
                            <span class="nc">Log</span><span class="p">.</span><span class="nf">e</span><span class="p">(</span>
                                <span class="s">"TutorialRenderer"</span><span class="p">,</span>
                                <span class="s">"Banner caching failed: ${it.description}"</span>
                            <span class="p">)</span>
                        <span class="p">}</span>
                    <span class="p">)</span>
                <span class="p">}</span>
                <span class="p">.</span><span class="nf">flatMap</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="nf">toImageBitmap</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">bannerImage</span><span class="p">)</span> <span class="p">}</span>
                <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="nc">Pair</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">it</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-6"> <a href="#step-6" class="anchor-heading" aria-labelledby="step-6"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 6 </h3> <p>In addition, the <a href="ad_sdk/com.adition.ad_sdk.api.core/-ad-renderer/configure.html">AdRenderer.configure</a> method has an <code class="language-plaintext highlighter-rouge">adMetadata</code> parameter. This <a href="ad_sdk/com.adition.ad_sdk.api.entities.response/-ad-metadata/index.html">AdMetadata</a> will be available in the app, and you can use it to pass some additional information from the renderer to the app.</p> <p><strong>Note:</strong> If you use interactive elements in the upper right corner of your banner, <code class="language-plaintext highlighter-rouge">isDSAButtonShown</code> may also be useful for you. If this value is <code class="language-plaintext highlighter-rouge">true</code>, you should reserve 21 dp for this button.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TutorialRenderer</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">assetRepository</span><span class="p">:</span> <span class="nc">AssetRepository</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">AdRenderer</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">jsonFormat</span> <span class="p">=</span> <span class="nc">Json</span> <span class="p">{</span> <span class="n">ignoreUnknownKeys</span> <span class="p">=</span> <span class="k">true</span> <span class="p">}</span>

    <span class="c1">// Will be called every time an ad is loaded or reloaded.</span>
    <span class="k">override</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">configure</span><span class="p">(</span>
        <span class="n">adResponse</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="n">adMetadata</span><span class="p">:</span> <span class="nc">AdMetadata</span>
    <span class="p">)</span> <span class="p">=</span> <span class="n">jsonFormat</span><span class="p">.</span><span class="n">decodeString</span><span class="p">&lt;</span><span class="nc">TutorialRendererResponse</span><span class="p">&gt;(</span><span class="n">adResponse</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">flatMap</span> <span class="p">{</span> <span class="n">response</span> <span class="p">-&gt;</span>
            <span class="c1">// ...</span>
        <span class="p">}</span>
        <span class="p">.</span><span class="nf">onSuccess</span> <span class="p">{</span>
            <span class="n">adMetadata</span><span class="p">.</span><span class="n">rendererMetadata</span> <span class="p">=</span> <span class="nf">mutableMapOf</span><span class="p">(</span>
                <span class="s">"custom_data"</span> <span class="n">to</span> <span class="s">"my custom data that will be available in the app"</span>
            <span class="p">)</span>
        <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-7"> <a href="#step-7" class="anchor-heading" aria-labelledby="step-7"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 7 </h3> <p>We’ve decoded the data we need and retrieved the ad banner, which means it’s time to change the state of our renderer so that the future composable knows it can display this content.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TutorialRenderer</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">assetRepository</span><span class="p">:</span> <span class="nc">AssetRepository</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">AdRenderer</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">rendererData</span> <span class="p">=</span> <span class="nc">MutableStateFlow</span><span class="p">&lt;</span><span class="nc">RendererData</span><span class="p">?&gt;(</span><span class="k">null</span><span class="p">)</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">jsonFormat</span> <span class="p">=</span> <span class="nc">Json</span> <span class="p">{</span> <span class="n">ignoreUnknownKeys</span> <span class="p">=</span> <span class="k">true</span> <span class="p">}</span>

    <span class="c1">// Will be called every time an ad is loaded or reloaded.</span>
    <span class="k">override</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">configure</span><span class="p">(</span>
        <span class="n">adResponse</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="n">adMetadata</span><span class="p">:</span> <span class="nc">AdMetadata</span>
    <span class="p">)</span> <span class="p">=</span> <span class="n">jsonFormat</span><span class="p">.</span><span class="n">decodeString</span><span class="p">&lt;</span><span class="nc">TutorialRendererResponse</span><span class="p">&gt;(</span><span class="n">adResponse</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">flatMap</span> <span class="p">{</span> <span class="n">response</span> <span class="p">-&gt;</span>
            <span class="c1">// ...</span>
        <span class="p">}</span>
        <span class="p">.</span><span class="nf">onSuccess</span> <span class="p">{</span>
            <span class="c1">// ...</span>
        <span class="p">}</span>
        <span class="p">.</span><span class="nf">onSuccess</span> <span class="p">{</span> <span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">banner</span><span class="p">)</span> <span class="p">-&gt;</span>
            <span class="n">rendererData</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="nc">RendererData</span><span class="p">(</span>
                <span class="n">banner</span> <span class="p">=</span> <span class="n">banner</span><span class="p">,</span>
                <span class="n">framingWidth</span> <span class="p">=</span> <span class="n">response</span><span class="p">.</span><span class="n">framingWidth</span><span class="p">,</span>
                <span class="n">isBlackFraming</span> <span class="p">=</span> <span class="n">response</span><span class="p">.</span><span class="n">isBlackFraming</span>
            <span class="p">)</span>
        <span class="p">}</span>
        <span class="p">.</span><span class="nf">map</span> <span class="p">{}</span>

    <span class="kd">data class</span> <span class="nc">RendererData</span><span class="p">(</span>
        <span class="kd">val</span> <span class="py">banner</span><span class="p">:</span> <span class="nc">ImageBitmap</span><span class="p">,</span>
        <span class="kd">val</span> <span class="py">framingWidth</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
        <span class="kd">val</span> <span class="py">isBlackFraming</span><span class="p">:</span> <span class="nc">Boolean</span>
    <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-8"> <a href="#step-8" class="anchor-heading" aria-labelledby="step-8"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 8 </h3> <p>This concludes the configuration of our renderer, so we can now proceed to the next method – <a href="ad_sdk/com.adition.ad_sdk.api.core/-ad-renderer/prepare-for-reload.html">AdRenderer.prepareForReload</a>. In it, you can implement logic to clear your state and prepare for a reload.</p> <p>In our case, it’s not very useful, but it can come in handy, for example, if your renderer uses a timer or another process that you would like to reset.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TutorialRenderer</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">assetRepository</span><span class="p">:</span> <span class="nc">AssetRepository</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">AdRenderer</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">rendererData</span> <span class="p">=</span> <span class="nc">MutableStateFlow</span><span class="p">&lt;</span><span class="nc">RendererData</span><span class="p">?&gt;(</span><span class="k">null</span><span class="p">)</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">jsonFormat</span> <span class="p">=</span> <span class="nc">Json</span> <span class="p">{</span> <span class="n">ignoreUnknownKeys</span> <span class="p">=</span> <span class="k">true</span> <span class="p">}</span>

    <span class="c1">// Will be called every time an ad is loaded or reloaded.</span>
    <span class="k">override</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">configure</span><span class="p">(</span>
        <span class="n">adResponse</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="n">adMetadata</span><span class="p">:</span> <span class="nc">AdMetadata</span>
    <span class="p">)</span> <span class="p">=</span> <span class="n">jsonFormat</span><span class="p">.</span><span class="n">decodeString</span><span class="p">&lt;</span><span class="nc">TutorialRendererResponse</span><span class="p">&gt;(</span><span class="n">adResponse</span><span class="p">)</span>
        <span class="c1">// ...</span>

    <span class="c1">// Will be called when app want to reload the ad</span>
    <span class="k">override</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">prepareForReload</span><span class="p">():</span> <span class="nc">AdResult</span><span class="p">&lt;</span><span class="nc">Unit</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="n">rendererData</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="k">null</span>
        <span class="k">return</span> <span class="nc">AdResult</span><span class="p">.</span><span class="nc">Success</span><span class="p">(</span><span class="nc">Unit</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">data class</span> <span class="nc">RendererData</span><span class="p">(</span>
        <span class="c1">// ...</span>
    <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-9"> <a href="#step-9" class="anchor-heading" aria-labelledby="step-9"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 9 </h3> <p>The final method in this section is <a href="ad_sdk/com.adition.ad_sdk.api.core/-ad-renderer/dispose.html">AdRenderer.dispose</a>. This is an optional method that you can use to clean up your renderer and finish all processes before it is destroyed.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TutorialRenderer</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">assetRepository</span><span class="p">:</span> <span class="nc">AssetRepository</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">AdRenderer</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">rendererData</span> <span class="p">=</span> <span class="nc">MutableStateFlow</span><span class="p">&lt;</span><span class="nc">RendererData</span><span class="p">?&gt;(</span><span class="k">null</span><span class="p">)</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">jsonFormat</span> <span class="p">=</span> <span class="nc">Json</span> <span class="p">{</span> <span class="n">ignoreUnknownKeys</span> <span class="p">=</span> <span class="k">true</span> <span class="p">}</span>

    <span class="c1">// Will be called every time an ad is loaded or reloaded.</span>
    <span class="k">override</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">configure</span><span class="p">(</span>
        <span class="n">adResponse</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="n">adMetadata</span><span class="p">:</span> <span class="nc">AdMetadata</span>
    <span class="p">)</span> <span class="p">=</span> <span class="n">jsonFormat</span><span class="p">.</span><span class="n">decodeString</span><span class="p">&lt;</span><span class="nc">TutorialRendererResponse</span><span class="p">&gt;(</span><span class="n">adResponse</span><span class="p">)</span>
        <span class="c1">// ...</span>

    <span class="c1">// Will be called when app want to reload the ad</span>
    <span class="k">override</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">prepareForReload</span><span class="p">():</span> <span class="nc">AdResult</span><span class="p">&lt;</span><span class="nc">Unit</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="c1">// Called before renderer will be removed</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">dispose</span><span class="p">()</span> <span class="p">{</span>

    <span class="p">}</span>

    <span class="kd">data class</span> <span class="nc">RendererData</span><span class="p">(</span>
        <span class="c1">// ...</span>
    <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-10"> <a href="#step-10" class="anchor-heading" aria-labelledby="step-10"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 10 </h3> <p>The most obvious example of using this method is cancelling all internal coroutines.</p> <p>We create an internal <code class="language-plaintext highlighter-rouge">CoroutineScope</code> that we will use in the future, and with the <a href="ad_sdk/com.adition.ad_sdk.api.core/-ad-renderer/dispose.html">AdRenderer.dispose</a> method, we can be sure that our renderer will not cause any leaks in the future.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TutorialRenderer</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">assetRepository</span><span class="p">:</span> <span class="nc">AssetRepository</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">coroutineScope</span><span class="p">:</span> <span class="nc">CoroutineScope</span> <span class="p">=</span> <span class="nc">CoroutineScope</span><span class="p">(</span>
        <span class="nc">SupervisorJob</span><span class="p">()</span> <span class="p">+</span> <span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">Main</span><span class="p">.</span><span class="n">immediate</span>
    <span class="p">)</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">AdRenderer</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">rendererData</span> <span class="p">=</span> <span class="nc">MutableStateFlow</span><span class="p">&lt;</span><span class="nc">RendererData</span><span class="p">?&gt;(</span><span class="k">null</span><span class="p">)</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">jsonFormat</span> <span class="p">=</span> <span class="nc">Json</span> <span class="p">{</span> <span class="n">ignoreUnknownKeys</span> <span class="p">=</span> <span class="k">true</span> <span class="p">}</span>

    <span class="c1">// Will be called every time an ad is loaded or reloaded.</span>
    <span class="k">override</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">configure</span><span class="p">(</span>
        <span class="n">adResponse</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="n">adMetadata</span><span class="p">:</span> <span class="nc">AdMetadata</span>
    <span class="p">)</span> <span class="p">=</span> <span class="n">jsonFormat</span><span class="p">.</span><span class="n">decodeString</span><span class="p">&lt;</span><span class="nc">TutorialRendererResponse</span><span class="p">&gt;(</span><span class="n">adResponse</span><span class="p">)</span>
        <span class="c1">// ...</span>

    <span class="c1">// Will be called when app want to reload the ad</span>
    <span class="k">override</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">prepareForReload</span><span class="p">():</span> <span class="nc">AdResult</span><span class="p">&lt;</span><span class="nc">Unit</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="c1">// Called before renderer will be removed</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">dispose</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">rendererData</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="k">null</span>
        <span class="n">coroutineScope</span><span class="p">.</span><span class="nf">cancel</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">data class</span> <span class="nc">RendererData</span><span class="p">(</span>
        <span class="c1">// ...</span>
    <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="section-3-event-management"> <a href="#section-3-event-management" class="anchor-heading" aria-labelledby="section-3-event-management"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Section 3: Event management </h2> <p>In the previous section, we implemented the logic associated with loading, reloading, and cleaning your custom ad. The next step will be to implement the processing of ad-related events.</p> <h3 id="step-1-2"> <a href="#step-1-2" class="anchor-heading" aria-labelledby="step-1-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1 </h3> <p>Let’s continue working with our <code class="language-plaintext highlighter-rouge">TutorialRenderer</code>. Almost all ads need to handle taps, but our renderer doesn’t have this functionality at the moment.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TutorialRenderer</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">assetRepository</span><span class="p">:</span> <span class="nc">AssetRepository</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">coroutineScope</span><span class="p">:</span> <span class="nc">CoroutineScope</span> <span class="p">=</span> <span class="nc">CoroutineScope</span><span class="p">(</span>
        <span class="nc">SupervisorJob</span><span class="p">()</span> <span class="p">+</span> <span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">Main</span><span class="p">.</span><span class="n">immediate</span>
    <span class="p">)</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">AdRenderer</span> <span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="kd">data class</span> <span class="nc">RendererData</span><span class="p">(</span>
        <span class="c1">// ...</span>
    <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-2-2"> <a href="#step-2-2" class="anchor-heading" aria-labelledby="step-2-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2 </h3> <p>In order to execute or notify about an event, we use <a href="ad_sdk/com.adition.ad_sdk.api.core/-ad-renderer-event-handler/index.html">AdRendererEventHandler</a>. In fact, it is an <a href="ad_sdk/com.adition.ad_sdk.api.core/-advertisement/index.html">Advertisement</a> object that knows how to handle certain events.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TutorialRenderer</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">assetRepository</span><span class="p">:</span> <span class="nc">AssetRepository</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">eventHandler</span><span class="p">:</span> <span class="nc">AdRendererEventHandler</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">coroutineScope</span><span class="p">:</span> <span class="nc">CoroutineScope</span> <span class="p">=</span> <span class="nc">CoroutineScope</span><span class="p">(</span>
        <span class="nc">SupervisorJob</span><span class="p">()</span> <span class="p">+</span> <span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">Main</span><span class="p">.</span><span class="n">immediate</span>
    <span class="p">)</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">AdRenderer</span> <span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="kd">data class</span> <span class="nc">RendererData</span><span class="p">(</span>
        <span class="c1">// ...</span>
    <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-3-2"> <a href="#step-3-2" class="anchor-heading" aria-labelledby="step-3-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 3 </h3> <p>Now we can implement the method that will be called when the banner is tapped.</p> <p><strong>Note:</strong> Some events return <a href="ad_sdk/com.adition.ad_sdk.api.entities.exception/-ad-result/index.html">AdResult</a>, which indicates that the renderer may catch errors when executing events. If an error occurs when processing an event, you should not attempt to repeat it, as this is the responsibility of the app, which can do so using <a href="ad_sdk/com.adition.ad_sdk.api.services.event_listener/-ad-event-listener/index.html">AdEventListener</a>. You can use this error to debug or change the state of the presentation.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TutorialRenderer</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">assetRepository</span><span class="p">:</span> <span class="nc">AssetRepository</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">eventHandler</span><span class="p">:</span> <span class="nc">AdRendererEventHandler</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">coroutineScope</span><span class="p">:</span> <span class="nc">CoroutineScope</span> <span class="p">=</span> <span class="nc">CoroutineScope</span><span class="p">(</span>
        <span class="nc">SupervisorJob</span><span class="p">()</span> <span class="p">+</span> <span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">Main</span><span class="p">.</span><span class="n">immediate</span>
    <span class="p">)</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">AdRenderer</span> <span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">fun</span> <span class="nf">onTap</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">coroutineScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span> 
            <span class="n">eventHandler</span><span class="p">.</span><span class="nf">performTap</span><span class="p">(</span><span class="nc">AdTapEvent</span><span class="p">.</span><span class="nc">Tap</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">data class</span> <span class="nc">RendererData</span><span class="p">(</span>
        <span class="c1">// ...</span>
    <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-4-2"> <a href="#step-4-2" class="anchor-heading" aria-labelledby="step-4-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 4 </h3> <p>The tap event is not the only event that <a href="ad_sdk/com.adition.ad_sdk.api.core/-ad-renderer-event-handler/index.html">AdRendererEventHandler</a> can handle. You can find all events in the <a href="ad_sdk/com.adition.ad_sdk.api.core/-ad-renderer-event-handler/index.html">AdRendererEventHandler</a> documentation.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TutorialRenderer</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">assetRepository</span><span class="p">:</span> <span class="nc">AssetRepository</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">eventHandler</span><span class="p">:</span> <span class="nc">AdRendererEventHandler</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">coroutineScope</span><span class="p">:</span> <span class="nc">CoroutineScope</span> <span class="p">=</span> <span class="nc">CoroutineScope</span><span class="p">(</span>
        <span class="nc">SupervisorJob</span><span class="p">()</span> <span class="p">+</span> <span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">Main</span><span class="p">.</span><span class="n">immediate</span>
    <span class="p">)</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">AdRenderer</span> <span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">fun</span> <span class="nf">onTap</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">coroutineScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="n">eventHandler</span><span class="p">.</span><span class="nf">performTap</span><span class="p">(</span><span class="nc">AdTapEvent</span><span class="p">.</span><span class="nc">Tap</span><span class="p">)</span>
            <span class="c1">// eventHandler.unloadRequest()</span>
            <span class="c1">// eventHandler.sendMessage("Message_to_app", "My message to the app")</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">data class</span> <span class="nc">RendererData</span><span class="p">(</span>
        <span class="c1">// ...</span>
    <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="section-4-creating-a-presentation-layer"> <a href="#section-4-creating-a-presentation-layer" class="anchor-heading" aria-labelledby="section-4-creating-a-presentation-layer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Section 4: Creating a presentation layer </h2> <p>Even though our business layer is ready, we still can’t build our project. That’s because the <a href="ad_sdk/com.adition.ad_sdk.api.core/-ad-renderer/index.html">AdRenderer</a> requires a presentation layer.</p> <h3 id="step-1-3"> <a href="#step-1-3" class="anchor-heading" aria-labelledby="step-1-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1 </h3> <p>The <a href="ad_sdk/com.adition.ad_sdk.api.core/-ad-renderer/index.html">AdRenderer</a> interface has a mandatory method <a href="ad_sdk/com.adition.ad_sdk.api.core/-ad-renderer/-render-ad.html">AdRenderer.RenderAd</a>. This method is exactly where we need to implement the presentation logic.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TutorialRenderer</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">assetRepository</span><span class="p">:</span> <span class="nc">AssetRepository</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">eventHandler</span><span class="p">:</span> <span class="nc">AdRendererEventHandler</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">coroutineScope</span><span class="p">:</span> <span class="nc">CoroutineScope</span> <span class="p">=</span> <span class="nc">CoroutineScope</span><span class="p">(</span>
        <span class="nc">SupervisorJob</span><span class="p">()</span> <span class="p">+</span> <span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">Main</span><span class="p">.</span><span class="n">immediate</span>
    <span class="p">)</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">AdRenderer</span> <span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="nd">@Composable</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">RenderAd</span><span class="p">(</span><span class="n">modifier</span><span class="p">:</span> <span class="nc">Modifier</span><span class="p">)</span> <span class="p">{</span>
        
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-2-3"> <a href="#step-2-3" class="anchor-heading" aria-labelledby="step-2-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2 </h3> <p>First, we will observe the <code class="language-plaintext highlighter-rouge">rendererData</code> to get the data we need.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TutorialRenderer</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">assetRepository</span><span class="p">:</span> <span class="nc">AssetRepository</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">eventHandler</span><span class="p">:</span> <span class="nc">AdRendererEventHandler</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">coroutineScope</span><span class="p">:</span> <span class="nc">CoroutineScope</span> <span class="p">=</span> <span class="nc">CoroutineScope</span><span class="p">(</span>
        <span class="nc">SupervisorJob</span><span class="p">()</span> <span class="p">+</span> <span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">Main</span><span class="p">.</span><span class="n">immediate</span>
    <span class="p">)</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">AdRenderer</span> <span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="nd">@Composable</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">RenderAd</span><span class="p">(</span><span class="n">modifier</span><span class="p">:</span> <span class="nc">Modifier</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">data</span> <span class="p">=</span> <span class="n">rendererData</span><span class="p">.</span><span class="nf">collectAsState</span><span class="p">()</span>
        <span class="n">data</span><span class="p">.</span><span class="n">value</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span>
            
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-3-3"> <a href="#step-3-3" class="anchor-heading" aria-labelledby="step-3-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 3 </h3> <p>After that, all we have left to do is implement the banner display with a frame and process tap on this advertisement.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TutorialRenderer</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">assetRepository</span><span class="p">:</span> <span class="nc">AssetRepository</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">eventHandler</span><span class="p">:</span> <span class="nc">AdRendererEventHandler</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">coroutineScope</span><span class="p">:</span> <span class="nc">CoroutineScope</span> <span class="p">=</span> <span class="nc">CoroutineScope</span><span class="p">(</span>
        <span class="nc">SupervisorJob</span><span class="p">()</span> <span class="p">+</span> <span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">Main</span><span class="p">.</span><span class="n">immediate</span>
    <span class="p">)</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">AdRenderer</span> <span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="nd">@Composable</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">RenderAd</span><span class="p">(</span><span class="n">modifier</span><span class="p">:</span> <span class="nc">Modifier</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">data</span> <span class="p">=</span> <span class="n">rendererData</span><span class="p">.</span><span class="nf">collectAsState</span><span class="p">()</span>
        <span class="n">data</span><span class="p">.</span><span class="n">value</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">borderColor</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">isBlackFraming</span><span class="p">)</span> <span class="nc">Color</span><span class="p">.</span><span class="nc">Black</span> <span class="k">else</span> <span class="nc">Color</span><span class="p">.</span><span class="nc">White</span>
            <span class="nc">Box</span><span class="p">(</span>
                <span class="n">modifier</span> <span class="p">=</span> <span class="n">modifier</span>
                    <span class="p">.</span><span class="nf">border</span><span class="p">(</span>
                        <span class="n">width</span> <span class="p">=</span> <span class="n">it</span><span class="p">.</span><span class="n">framingWidth</span><span class="p">.</span><span class="n">dp</span><span class="p">,</span>
                        <span class="n">color</span> <span class="p">=</span> <span class="n">borderColor</span>
                    <span class="p">)</span>
                    <span class="p">.</span><span class="nf">clickable</span> <span class="p">{</span> <span class="nf">onTap</span><span class="p">()</span> <span class="p">}</span>
            <span class="p">)</span> <span class="p">{</span>
                <span class="nc">Image</span><span class="p">(</span>
                    <span class="n">bitmap</span> <span class="p">=</span> <span class="n">it</span><span class="p">.</span><span class="n">banner</span><span class="p">,</span>
                    <span class="n">contentDescription</span> <span class="p">=</span> <span class="k">null</span>
                <span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="section-5-registering-a-renderer-in-the-sdk"> <a href="#section-5-registering-a-renderer-in-the-sdk" class="anchor-heading" aria-labelledby="section-5-registering-a-renderer-in-the-sdk"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Section 5: Registering a renderer in the SDK </h2> <p>Although we have created a custom ad, in order for the SDK to use it, we need to pass it to the SDK somehow. Let’s do that.</p> <h3 id="step-1-4"> <a href="#step-1-4" class="anchor-heading" aria-labelledby="step-1-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1 </h3> <p>First of all, let’s get back to our response from the server. As you can see, it includes the <code class="language-plaintext highlighter-rouge">ad_name</code> field. It is this field that the SDK will use to identify your renderer.</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="err">//</span><span class="w"> </span><span class="err">...</span><span class="w">
    </span><span class="err">ad_name:</span><span class="w"> </span><span class="s2">"tutorialad"</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">&lt;----------</span><span class="w">
    </span><span class="err">body:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">//</span><span class="w"> </span><span class="err">...</span><span class="w">
        </span><span class="err">ext:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="err">//</span><span class="w"> </span><span class="err">...</span><span class="w">
            </span><span class="err">adData:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="err">banner_image:</span><span class="w"> </span><span class="err">Banner</span><span class="w"> </span><span class="err">URL</span><span class="p">,</span><span class="w">
                </span><span class="err">framing_width:</span><span class="w"> </span><span class="err">Framing</span><span class="w"> </span><span class="err">width</span><span class="p">,</span><span class="w">
                </span><span class="err">is_black_framing:</span><span class="w"> </span><span class="err">Boolean</span><span class="w"> </span><span class="err">value</span><span class="w"> </span><span class="err">–</span><span class="w"> </span><span class="err">whether</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">color</span><span class="w"> </span><span class="err">should</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">black</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">white.</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <h3 id="step-2-4"> <a href="#step-2-4" class="anchor-heading" aria-labelledby="step-2-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2 </h3> <p>Let’s go to the <code class="language-plaintext highlighter-rouge">MainScreen.kt</code> file, the place where we create our <a href="ad_sdk/com.adition.ad_sdk.api.core/-ad-service/index.html">AdService</a>. This is where we will be able to register our custom renderer.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">MainScreen.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="kd">class</span> <span class="nc">MainViewModel</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">adServiceProvider</span><span class="p">:</span> <span class="nc">AdServiceProviderInterface</span> <span class="p">=</span> <span class="nc">ServiceLocator</span><span class="p">.</span><span class="n">adServiceProvider</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">fun</span> <span class="nf">onLoad</span><span class="p">(</span><span class="n">isDataCollectionAllowed</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="n">adServiceProvider</span>
                <span class="p">.</span><span class="nf">configure</span><span class="p">(</span>
                    <span class="s">"1800"</span><span class="p">,</span>
                    <span class="n">parentCoroutineScope</span> <span class="p">=</span> <span class="k">this</span><span class="p">,</span>
                    <span class="n">cacheSize</span> <span class="p">=</span> <span class="mi">20u</span><span class="p">,</span>
                    <span class="n">globalParameters</span> <span class="p">=</span> <span class="n">globalParameters</span><span class="p">,</span>
                    <span class="n">adRequestGlobalParameters</span> <span class="p">=</span> <span class="n">adRequestGlobalParameters</span>
                <span class="p">)</span>
                <span class="c1">// ...</span>
                <span class="p">.</span><span class="nf">onSuccess</span> <span class="p">{</span> <span class="n">adService</span> <span class="p">-&gt;</span>
                    <span class="c1">// ...</span>
                <span class="p">}</span>
                <span class="p">.</span><span class="k">get</span><span class="p">(</span>
                    <span class="n">onSuccess</span> <span class="p">=</span> <span class="p">{</span> <span class="n">_state</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="nc">PresentationState</span><span class="p">.</span><span class="nc">Loaded</span><span class="p">(</span><span class="nc">Unit</span><span class="p">)</span> <span class="p">},</span>
                    <span class="n">onError</span> <span class="p">=</span> <span class="p">{</span> <span class="n">_state</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="nc">PresentationState</span><span class="p">.</span><span class="nc">Error</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">description</span><span class="p">)</span> <span class="p">}</span>
                <span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
<span class="c1">// ...</span>
</code></pre></div></div> <h3 id="step-3-4"> <a href="#step-3-4" class="anchor-heading" aria-labelledby="step-3-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 3 </h3> <p>All we need to do is use the <a href="ad_sdk/com.adition.ad_sdk.api.core/-ad-service/register-renderer.html">AdService.registerRenderer</a> method, passing in the value we expect to receive in the <code class="language-plaintext highlighter-rouge">ad_name</code> field and the renderer factory method, which we will review in more detail in the next step.</p> <p>This way, every time the <code class="language-plaintext highlighter-rouge">ad_name</code> field in the server response is the same as the <code class="language-plaintext highlighter-rouge">String</code> you passed to this method, the SDK will build the renderer using provided factory method.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">MainScreen.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="kd">class</span> <span class="nc">MainViewModel</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">adServiceProvider</span><span class="p">:</span> <span class="nc">AdServiceProviderInterface</span> <span class="p">=</span> <span class="nc">ServiceLocator</span><span class="p">.</span><span class="n">adServiceProvider</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">fun</span> <span class="nf">onLoad</span><span class="p">(</span><span class="n">isDataCollectionAllowed</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="n">adServiceProvider</span>
                <span class="p">.</span><span class="nf">configure</span><span class="p">(</span>
                    <span class="s">"1800"</span><span class="p">,</span>
                    <span class="n">parentCoroutineScope</span> <span class="p">=</span> <span class="k">this</span><span class="p">,</span>
                    <span class="n">cacheSize</span> <span class="p">=</span> <span class="mi">20u</span><span class="p">,</span>
                    <span class="n">globalParameters</span> <span class="p">=</span> <span class="n">globalParameters</span><span class="p">,</span>
                    <span class="n">adRequestGlobalParameters</span> <span class="p">=</span> <span class="n">adRequestGlobalParameters</span>
                <span class="p">)</span>
                <span class="c1">// ...</span>
                <span class="p">.</span><span class="nf">onSuccess</span> <span class="p">{</span> <span class="n">adService</span> <span class="p">-&gt;</span>
                    <span class="c1">// ...</span>
                <span class="p">}</span>
                <span class="p">.</span><span class="nf">onSuccess</span> <span class="p">{</span>
                    <span class="n">it</span><span class="p">.</span><span class="nf">registerRenderer</span><span class="p">(</span><span class="s">"tutorialad"</span><span class="p">)</span> <span class="p">{</span> <span class="n">serviceLocator</span> <span class="p">-&gt;</span>
                        
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="p">.</span><span class="k">get</span><span class="p">(</span>
                    <span class="n">onSuccess</span> <span class="p">=</span> <span class="p">{</span> <span class="n">_state</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="nc">PresentationState</span><span class="p">.</span><span class="nc">Loaded</span><span class="p">(</span><span class="nc">Unit</span><span class="p">)</span> <span class="p">},</span>
                    <span class="n">onError</span> <span class="p">=</span> <span class="p">{</span> <span class="n">_state</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="nc">PresentationState</span><span class="p">.</span><span class="nc">Error</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">description</span><span class="p">)</span> <span class="p">}</span>
                <span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
<span class="c1">// ...</span>
</code></pre></div></div> <h3 id="step-4-3"> <a href="#step-4-3" class="anchor-heading" aria-labelledby="step-4-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 4 </h3> <p>Now let’s take a closer look at the factory method. An important parameter is <a href="ad_sdk/com.adition.ad_sdk.api.core/-ad-renderer/-service-locator/index.html">AdRenderer.ServiceLocator</a>. You can use it as a DI container or a Service Locator when creating your renderer.</p> <p><a href="ad_sdk/com.adition.ad_sdk.api.core/-ad-renderer/-service-locator/index.html">AdRenderer.ServiceLocator</a> contains all the information and services that can be used when creating a custom renderer. In our case, these are <a href="ad_sdk/com.adition.ad_sdk.api.services.asset_repository/-asset-repository/index.html">AssetRepository</a> and <a href="ad_sdk/com.adition.ad_sdk.api.core/-ad-renderer-event-handler/index.html">AdRendererEventHandler</a>.</p> <p><strong>Note:</strong> We will look at other services later in this tutorial. All data and services can be found in the <a href="ad_sdk/com.adition.ad_sdk.api.core/-ad-renderer/-service-locator/index.html">AdRenderer.ServiceLocator</a> documentation.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">MainScreen.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="kd">class</span> <span class="nc">MainViewModel</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">adServiceProvider</span><span class="p">:</span> <span class="nc">AdServiceProviderInterface</span> <span class="p">=</span> <span class="nc">ServiceLocator</span><span class="p">.</span><span class="n">adServiceProvider</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">fun</span> <span class="nf">onLoad</span><span class="p">(</span><span class="n">isDataCollectionAllowed</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="n">adServiceProvider</span>
                <span class="p">.</span><span class="nf">configure</span><span class="p">(</span>
                    <span class="s">"1800"</span><span class="p">,</span>
                    <span class="n">parentCoroutineScope</span> <span class="p">=</span> <span class="k">this</span><span class="p">,</span>
                    <span class="n">cacheSize</span> <span class="p">=</span> <span class="mi">20u</span><span class="p">,</span>
                    <span class="n">globalParameters</span> <span class="p">=</span> <span class="n">globalParameters</span><span class="p">,</span>
                    <span class="n">adRequestGlobalParameters</span> <span class="p">=</span> <span class="n">adRequestGlobalParameters</span>
                <span class="p">)</span>
                <span class="c1">// ...</span>
                <span class="p">.</span><span class="nf">onSuccess</span> <span class="p">{</span> <span class="n">adService</span> <span class="p">-&gt;</span>
                    <span class="c1">// ...</span>
                <span class="p">}</span>
                <span class="p">.</span><span class="nf">onSuccess</span> <span class="p">{</span>
                    <span class="n">it</span><span class="p">.</span><span class="nf">registerRenderer</span><span class="p">(</span><span class="s">"tutorialad"</span><span class="p">)</span> <span class="p">{</span> <span class="n">serviceLocator</span> <span class="p">-&gt;</span>
                        <span class="nc">TutorialRenderer</span><span class="p">(</span>
                            <span class="n">assetRepository</span> <span class="p">=</span> <span class="n">serviceLocator</span><span class="p">.</span><span class="n">assetRepository</span><span class="p">,</span>
                            <span class="n">eventHandler</span> <span class="p">=</span> <span class="n">serviceLocator</span><span class="p">.</span><span class="n">eventHandler</span>
                        <span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="p">.</span><span class="k">get</span><span class="p">(</span>
                    <span class="n">onSuccess</span> <span class="p">=</span> <span class="p">{</span> <span class="n">_state</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="nc">PresentationState</span><span class="p">.</span><span class="nc">Loaded</span><span class="p">(</span><span class="nc">Unit</span><span class="p">)</span> <span class="p">},</span>
                    <span class="n">onError</span> <span class="p">=</span> <span class="p">{</span> <span class="n">_state</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="nc">PresentationState</span><span class="p">.</span><span class="nc">Error</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">description</span><span class="p">)</span> <span class="p">}</span>
                <span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
<span class="c1">// ...</span>
</code></pre></div></div> <h3 id="step-5-2"> <a href="#step-5-2" class="anchor-heading" aria-labelledby="step-5-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 5 </h3> <p>The final step is to add a new <a href="ad_sdk/com.adition.ad_sdk.api.entities.request/-ad-request/index.html">AdRequest</a>. To do this, open <code class="language-plaintext highlighter-rouge">InlineScreen.kt</code> and add a new <a href="ad_sdk/com.adition.ad_sdk.api.entities.request/-ad-request/index.html">AdRequest</a> to the beginning of the <code class="language-plaintext highlighter-rouge">requests</code> list in the <code class="language-plaintext highlighter-rouge">getDataSource</code> method.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">InlineScreen.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="kd">class</span> <span class="nc">InlineViewModel</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">adService</span><span class="p">:</span> <span class="nc">AdService</span> <span class="p">=</span> <span class="nc">ServiceLocator</span><span class="p">.</span><span class="n">adService</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">getDataSource</span><span class="p">():</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">AdItemState</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">supervisorScope</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">requests</span> <span class="p">=</span> <span class="nc">MutableList</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
            <span class="nc">AdRequest</span><span class="p">(</span>
                <span class="n">contentUnit</span> <span class="p">=</span> <span class="s">"4810915"</span><span class="p">,</span>
                <span class="n">profiles</span> <span class="p">=</span> <span class="nf">hashMapOf</span><span class="p">(),</span> <span class="c1">// Can be skipped</span>
                <span class="n">keywords</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(),</span> <span class="c1">// Can be skipped</span>
                <span class="n">window</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="c1">// Can be skipped</span>
                <span class="n">timeoutAfterSeconds</span> <span class="p">=</span> <span class="mi">10u</span><span class="p">,</span> <span class="c1">// Can be skipped</span>
                <span class="n">gdprPd</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="c1">// Can be skipped</span>
                <span class="n">campaignId</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="c1">// Can be skipped</span>
                <span class="n">bannerId</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="c1">// Can be skipped</span>
                <span class="n">isSHBEnabled</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="c1">// Can be skipped</span>
                <span class="n">dsa</span> <span class="p">=</span> <span class="k">null</span> <span class="c1">// Can be skipped</span>
            <span class="p">)</span>
        <span class="p">}</span>

        <span class="n">requests</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nc">AdRequest</span><span class="p">(</span><span class="n">contentUnit</span> <span class="p">=</span> <span class="s">"5227780"</span><span class="p">))</span>

        <span class="n">requests</span>
            <span class="p">.</span><span class="nf">mapIndexed</span> <span class="p">{</span> <span class="n">index</span><span class="p">,</span> <span class="n">request</span> <span class="p">-&gt;</span>
                <span class="nf">async</span> <span class="p">{</span>
                    <span class="kd">val</span> <span class="py">itemState</span> <span class="p">=</span> <span class="nc">AdItemState</span><span class="p">(</span>
                        <span class="n">index</span><span class="p">,</span>
                        <span class="n">adService</span><span class="p">,</span>
                        <span class="n">request</span><span class="p">,</span>
                        <span class="n">viewModelScope</span>
                    <span class="p">)</span>

                    <span class="n">itemState</span><span class="p">.</span><span class="nf">loadAdvertisement</span><span class="p">()</span>
                    <span class="n">itemState</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="p">.</span><span class="nf">awaitAll</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// ...</span>
</code></pre></div></div> <p>Now you can launch the app and see your new custom ad, congratulations!</p> <h2 id="section-6-advanced-management-of-advertising-resources"> <a href="#section-6-advanced-management-of-advertising-resources" class="anchor-heading" aria-labelledby="section-6-advanced-management-of-advertising-resources"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Section 6: Advanced management of advertising resources </h2> <p>Our ad can already load and cache an ad banner via <a href="ad_sdk/com.adition.ad_sdk.api.services.asset_repository/-asset-repository/index.html">AssetRepository</a>, but there are cases when you want to implement more flexible caching logic, for example, you want to put several ad resources in one folder. In this section, we will look at how to do this.</p> <h3 id="step-1-5"> <a href="#step-1-5" class="anchor-heading" aria-labelledby="step-1-5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1 </h3> <p>Return to the <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code> file, and comment out all code related to the <a href="ad_sdk/com.adition.ad_sdk.api.services.asset_repository/-asset-repository/index.html">AssetRepository</a>.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TutorialRenderer</span><span class="p">(</span>
    <span class="c1">// private val assetRepository: AssetRepository,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">eventHandler</span><span class="p">:</span> <span class="nc">AdRendererEventHandler</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">coroutineScope</span><span class="p">:</span> <span class="nc">CoroutineScope</span> <span class="p">=</span> <span class="nc">CoroutineScope</span><span class="p">(</span>
        <span class="nc">SupervisorJob</span><span class="p">()</span> <span class="p">+</span> <span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">Main</span><span class="p">.</span><span class="n">immediate</span>
    <span class="p">)</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">AdRenderer</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">override</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">configure</span><span class="p">(</span>
        <span class="n">adResponse</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="n">adMetadata</span><span class="p">:</span> <span class="nc">AdMetadata</span>
    <span class="p">)</span> <span class="p">=</span> <span class="n">jsonFormat</span><span class="p">.</span><span class="n">decodeString</span><span class="p">&lt;</span><span class="nc">TutorialRendererResponse</span><span class="p">&gt;(</span><span class="n">adResponse</span><span class="p">)</span>
        <span class="cm">/*
        .flatMap { response -&gt;
            assetRepository
                .getAsset(response.bannerImage)
                .onSuccess { assetResult -&gt;
                    assetResult.cacheResult.get(
                        onSuccess = {
                            Log.d("TutorialRenderer", "Banner cached: $it")
                        },
                        onError = {
                            Log.e(
                                "TutorialRenderer",
                                "Banner caching failed: ${it.description}"
                            )
                        }
                    )
                }
                .flatMap { it.data.toImageBitmap(response.bannerImage) }
                .map { Pair(response, it) }
        }
         */</span>
        <span class="p">.</span><span class="nf">onSuccess</span> <span class="p">{</span>
            <span class="c1">// ...</span>
        <span class="p">}</span>
        <span class="p">.</span><span class="nf">onSuccess</span> <span class="p">{</span> <span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">banner</span><span class="p">)</span> <span class="p">-&gt;</span>
            <span class="c1">// ...</span>
        <span class="p">}</span>
        <span class="p">.</span><span class="nf">map</span> <span class="p">{}</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-2-5"> <a href="#step-2-5" class="anchor-heading" aria-labelledby="step-2-5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2 </h3> <p>We will create our own implementation for loading and caching banner.</p> <p>To do this, we will create a method called <code class="language-plaintext highlighter-rouge">getBannerByteArray</code>, which we will use in the <a href="ad_sdk/com.adition.ad_sdk.api.core/-ad-renderer/configure.html">AdRenderer.configure</a> method instead of <a href="ad_sdk/com.adition.ad_sdk.api.services.asset_repository/-asset-repository/get-asset.html">AssetRepository.getAsset</a>.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TutorialRenderer</span><span class="p">(</span>
    <span class="c1">// private val assetRepository: AssetRepository,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">eventHandler</span><span class="p">:</span> <span class="nc">AdRendererEventHandler</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">coroutineScope</span><span class="p">:</span> <span class="nc">CoroutineScope</span> <span class="p">=</span> <span class="nc">CoroutineScope</span><span class="p">(</span>
        <span class="nc">SupervisorJob</span><span class="p">()</span> <span class="p">+</span> <span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">Main</span><span class="p">.</span><span class="n">immediate</span>
    <span class="p">)</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">AdRenderer</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">override</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">configure</span><span class="p">(</span>
        <span class="n">adResponse</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="n">adMetadata</span><span class="p">:</span> <span class="nc">AdMetadata</span>
    <span class="p">)</span> <span class="p">=</span> <span class="n">jsonFormat</span><span class="p">.</span><span class="n">decodeString</span><span class="p">&lt;</span><span class="nc">TutorialRendererResponse</span><span class="p">&gt;(</span><span class="n">adResponse</span><span class="p">)</span>
        <span class="cm">/*
        // ...
         */</span>
        <span class="p">.</span><span class="nf">flatMap</span> <span class="p">{</span> <span class="n">response</span> <span class="p">-&gt;</span>
            <span class="nf">getBannerByteArray</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">bannerImage</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">flatMap</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">toImageBitmap</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">bannerImage</span><span class="p">)</span> <span class="p">}</span>
                <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="nc">Pair</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">it</span><span class="p">)</span> <span class="p">}</span>
            
        <span class="p">}</span>
        <span class="p">.</span><span class="nf">onSuccess</span> <span class="p">{</span>
            <span class="c1">// ...</span>
        <span class="p">}</span>
        <span class="p">.</span><span class="nf">onSuccess</span> <span class="p">{</span> <span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">banner</span><span class="p">)</span> <span class="p">-&gt;</span>
            <span class="c1">// ...</span>
        <span class="p">}</span>
        <span class="p">.</span><span class="nf">map</span> <span class="p">{}</span>

    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">getBannerByteArray</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">AdResult</span><span class="p">&lt;</span><span class="nc">ByteArray</span><span class="p">&gt;</span> <span class="p">{</span>

    <span class="p">}</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-3-5"> <a href="#step-3-5" class="anchor-heading" aria-labelledby="step-3-5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 3 </h3> <p>To create our own implementation of loading and caching, we can use two other interfaces provided by <a href="ad_sdk/com.adition.ad_sdk.api.core/-ad-renderer/-service-locator/index.html">AdRenderer.ServiceLocator</a>: the <a href="ad_sdk/com.adition.ad_sdk.api.services.cache/-asset-cache/index.html">AssetCache</a> for working with the cache, and the <a href="ad_sdk/com.adition.ad_sdk.api.services.asset_request_service/-asset-request-service/index.html">AssetRequestService</a> which can be used to conveniently load ad resources. We pass them through the constructor.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TutorialRenderer</span><span class="p">(</span>
    <span class="c1">// private val assetRepository: AssetRepository,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">eventHandler</span><span class="p">:</span> <span class="nc">AdRendererEventHandler</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">cache</span><span class="p">:</span> <span class="nc">AssetCache</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">requestService</span><span class="p">:</span> <span class="nc">AssetRequestService</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">coroutineScope</span><span class="p">:</span> <span class="nc">CoroutineScope</span> <span class="p">=</span> <span class="nc">CoroutineScope</span><span class="p">(</span>
        <span class="nc">SupervisorJob</span><span class="p">()</span> <span class="p">+</span> <span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">Main</span><span class="p">.</span><span class="n">immediate</span>
    <span class="p">)</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">AdRenderer</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">getBannerByteArray</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">AdResult</span><span class="p">&lt;</span><span class="nc">ByteArray</span><span class="p">&gt;</span> <span class="p">{</span>

    <span class="p">}</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-4-4"> <a href="#step-4-4" class="anchor-heading" aria-labelledby="step-4-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 4 </h3> <p>It’s time to implement <code class="language-plaintext highlighter-rouge">getBannerByteArray</code> method. The first thing we will create is <a href="ad_sdk/com.adition.ad_sdk.api.services.cache/-asset-path/index.html">AssetPath</a>. In our case, we want the file name to be associated with the URL, and this resource is located in the <code class="language-plaintext highlighter-rouge">TutorialRendererResources</code> folder.</p> <p><strong>Note:</strong> When passing the URL to <a href="ad_sdk/com.adition.ad_sdk.api.services.cache/-asset-path/-companion/from-u-r-l.html">AssetPath.fromURL</a>, the <a href="ad_sdk/com.adition.ad_sdk.api.services.cache/-asset-path/index.html">AssetPath</a> will use the MD5 hash of the passed URL as the file name. You can also use the <a href="ad_sdk/com.adition.ad_sdk.api.services.cache/-asset-path/-companion/from-file-name.html">AssetPath.fromFileName</a> method if you want to pass the file name yourself.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TutorialRenderer</span><span class="p">(</span>
    <span class="c1">// private val assetRepository: AssetRepository,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">eventHandler</span><span class="p">:</span> <span class="nc">AdRendererEventHandler</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">cache</span><span class="p">:</span> <span class="nc">AssetCache</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">requestService</span><span class="p">:</span> <span class="nc">AssetRequestService</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">coroutineScope</span><span class="p">:</span> <span class="nc">CoroutineScope</span> <span class="p">=</span> <span class="nc">CoroutineScope</span><span class="p">(</span>
        <span class="nc">SupervisorJob</span><span class="p">()</span> <span class="p">+</span> <span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">Main</span><span class="p">.</span><span class="n">immediate</span>
    <span class="p">)</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">AdRenderer</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">getBannerByteArray</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">AdResult</span><span class="p">&lt;</span><span class="nc">ByteArray</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">path</span> <span class="p">=</span> <span class="nc">AssetPath</span><span class="p">.</span><span class="nf">fromURL</span><span class="p">(</span>
            <span class="n">folder</span> <span class="p">=</span> <span class="s">"TutorialRendererResources"</span><span class="p">,</span> <span class="c1">// Optional</span>
            <span class="n">url</span> <span class="p">=</span> <span class="n">url</span>
        <span class="p">)</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-5-3"> <a href="#step-5-3" class="anchor-heading" aria-labelledby="step-5-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 5 </h3> <p>Now we can check if our banner is cached via <a href="ad_sdk/com.adition.ad_sdk.api.services.cache/-asset-cache/read.html">AssetCache.read</a>, if so, we will use the cached data.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TutorialRenderer</span><span class="p">(</span>
    <span class="c1">// private val assetRepository: AssetRepository,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">eventHandler</span><span class="p">:</span> <span class="nc">AdRendererEventHandler</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">cache</span><span class="p">:</span> <span class="nc">AssetCache</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">requestService</span><span class="p">:</span> <span class="nc">AssetRequestService</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">coroutineScope</span><span class="p">:</span> <span class="nc">CoroutineScope</span> <span class="p">=</span> <span class="nc">CoroutineScope</span><span class="p">(</span>
        <span class="nc">SupervisorJob</span><span class="p">()</span> <span class="p">+</span> <span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">Main</span><span class="p">.</span><span class="n">immediate</span>
    <span class="p">)</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">AdRenderer</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">getBannerByteArray</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">AdResult</span><span class="p">&lt;</span><span class="nc">ByteArray</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">path</span> <span class="p">=</span> <span class="nc">AssetPath</span><span class="p">.</span><span class="nf">fromURL</span><span class="p">(</span>
            <span class="n">folder</span> <span class="p">=</span> <span class="s">"TutorialRendererResources"</span><span class="p">,</span> <span class="c1">// Optional</span>
            <span class="n">url</span> <span class="p">=</span> <span class="n">url</span>
        <span class="p">)</span>

        <span class="kd">val</span> <span class="py">cacheResult</span> <span class="p">=</span> <span class="n">cache</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="n">path</span><span class="p">).</span><span class="nf">getOrNull</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">cacheResult</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="p">(</span><span class="py">bytes</span><span class="p">,</span> <span class="py">uri</span><span class="p">)</span> <span class="p">=</span> <span class="n">cacheResult</span>
            <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"TutorialRenderer"</span><span class="p">,</span> <span class="s">"Banner loaded from cache: $uri"</span><span class="p">)</span>

            <span class="k">return</span> <span class="nc">AdResult</span><span class="p">.</span><span class="nc">Success</span><span class="p">(</span><span class="n">bytes</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"TutorialRenderer"</span><span class="p">,</span> <span class="s">"Banner not found in cache"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-6-1"> <a href="#step-6-1" class="anchor-heading" aria-labelledby="step-6-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 6 </h3> <p>If not, we can download the banner using <a href="ad_sdk/com.adition.ad_sdk.api.services.asset_request_service/-asset-request-service/index.html">AssetRequestService</a>.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TutorialRenderer</span><span class="p">(</span>
    <span class="c1">// private val assetRepository: AssetRepository,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">eventHandler</span><span class="p">:</span> <span class="nc">AdRendererEventHandler</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">cache</span><span class="p">:</span> <span class="nc">AssetCache</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">requestService</span><span class="p">:</span> <span class="nc">AssetRequestService</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">coroutineScope</span><span class="p">:</span> <span class="nc">CoroutineScope</span> <span class="p">=</span> <span class="nc">CoroutineScope</span><span class="p">(</span>
        <span class="nc">SupervisorJob</span><span class="p">()</span> <span class="p">+</span> <span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">Main</span><span class="p">.</span><span class="n">immediate</span>
    <span class="p">)</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">AdRenderer</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">getBannerByteArray</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">AdResult</span><span class="p">&lt;</span><span class="nc">ByteArray</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">path</span> <span class="p">=</span> <span class="nc">AssetPath</span><span class="p">.</span><span class="nf">fromURL</span><span class="p">(</span>
            <span class="n">folder</span> <span class="p">=</span> <span class="s">"TutorialRendererResources"</span><span class="p">,</span> <span class="c1">// Optional</span>
            <span class="n">url</span> <span class="p">=</span> <span class="n">url</span>
        <span class="p">)</span>

        <span class="kd">val</span> <span class="py">cacheResult</span> <span class="p">=</span> <span class="n">cache</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="n">path</span><span class="p">).</span><span class="nf">getOrNull</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">cacheResult</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="p">(</span><span class="py">bytes</span><span class="p">,</span> <span class="py">uri</span><span class="p">)</span> <span class="p">=</span> <span class="n">cacheResult</span>
            <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"TutorialRenderer"</span><span class="p">,</span> <span class="s">"Banner loaded from cache: $uri"</span><span class="p">)</span>

            <span class="k">return</span> <span class="nc">AdResult</span><span class="p">.</span><span class="nc">Success</span><span class="p">(</span><span class="n">bytes</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"TutorialRenderer"</span><span class="p">,</span> <span class="s">"Banner not found in cache"</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">requestService</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-7-1"> <a href="#step-7-1" class="anchor-heading" aria-labelledby="step-7-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 7 </h3> <p>Since the banner has already been loaded, we would like to cache it for future use. To do this, you can use the <a href="ad_sdk/com.adition.ad_sdk.api.services.cache/-asset-cache/write.html">AssetCache.write</a> method.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TutorialRenderer</span><span class="p">(</span>
    <span class="c1">// private val assetRepository: AssetRepository,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">eventHandler</span><span class="p">:</span> <span class="nc">AdRendererEventHandler</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">cache</span><span class="p">:</span> <span class="nc">AssetCache</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">requestService</span><span class="p">:</span> <span class="nc">AssetRequestService</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">coroutineScope</span><span class="p">:</span> <span class="nc">CoroutineScope</span> <span class="p">=</span> <span class="nc">CoroutineScope</span><span class="p">(</span>
        <span class="nc">SupervisorJob</span><span class="p">()</span> <span class="p">+</span> <span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">Main</span><span class="p">.</span><span class="n">immediate</span>
    <span class="p">)</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">AdRenderer</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">getBannerByteArray</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">AdResult</span><span class="p">&lt;</span><span class="nc">ByteArray</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">path</span> <span class="p">=</span> <span class="nc">AssetPath</span><span class="p">.</span><span class="nf">fromURL</span><span class="p">(</span>
            <span class="n">folder</span> <span class="p">=</span> <span class="s">"TutorialRendererResources"</span><span class="p">,</span> <span class="c1">// Optional</span>
            <span class="n">url</span> <span class="p">=</span> <span class="n">url</span>
        <span class="p">)</span>

        <span class="kd">val</span> <span class="py">cacheResult</span> <span class="p">=</span> <span class="n">cache</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="n">path</span><span class="p">).</span><span class="nf">getOrNull</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">cacheResult</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="p">(</span><span class="py">bytes</span><span class="p">,</span> <span class="py">uri</span><span class="p">)</span> <span class="p">=</span> <span class="n">cacheResult</span>
            <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"TutorialRenderer"</span><span class="p">,</span> <span class="s">"Banner loaded from cache: $uri"</span><span class="p">)</span>

            <span class="k">return</span> <span class="nc">AdResult</span><span class="p">.</span><span class="nc">Success</span><span class="p">(</span><span class="n">bytes</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"TutorialRenderer"</span><span class="p">,</span> <span class="s">"Banner not found in cache"</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">requestService</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">onSuccess</span> <span class="p">{</span> <span class="n">bytes</span> <span class="p">-&gt;</span>
                <span class="n">cache</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">bytes</span><span class="p">)</span>
                    <span class="p">.</span><span class="k">get</span><span class="p">(</span>
                        <span class="n">onSuccess</span> <span class="p">=</span> <span class="p">{</span>
                            <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span>
                                <span class="s">"TutorialRenderer"</span><span class="p">,</span>
                                <span class="s">"Banner cached after download: $it"</span>
                            <span class="p">)</span>
                        <span class="p">},</span>
                        <span class="n">onError</span> <span class="p">=</span> <span class="p">{</span>
                            <span class="nc">Log</span><span class="p">.</span><span class="nf">e</span><span class="p">(</span>
                                <span class="s">"TutorialRenderer"</span><span class="p">,</span>
                                <span class="s">"Banner loaded, but caching failed: ${it.description}"</span>
                            <span class="p">)</span>
                        <span class="p">}</span>
                    <span class="p">)</span>
            <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-8-1"> <a href="#step-8-1" class="anchor-heading" aria-labelledby="step-8-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 8 </h3> <p>You can also remove files from the cache if you need to.</p> <p><strong>Note:</strong> Most often, you do not need to remove resources manually, as the SDK itself manages the removal of files from the cache using a FIFO strategy and a cache size that is set from the app.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">TutorialRenderer.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TutorialRenderer</span><span class="p">(</span>
    <span class="c1">// private val assetRepository: AssetRepository,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">eventHandler</span><span class="p">:</span> <span class="nc">AdRendererEventHandler</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">cache</span><span class="p">:</span> <span class="nc">AssetCache</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">requestService</span><span class="p">:</span> <span class="nc">AssetRequestService</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">coroutineScope</span><span class="p">:</span> <span class="nc">CoroutineScope</span> <span class="p">=</span> <span class="nc">CoroutineScope</span><span class="p">(</span>
        <span class="nc">SupervisorJob</span><span class="p">()</span> <span class="p">+</span> <span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">Main</span><span class="p">.</span><span class="n">immediate</span>
    <span class="p">)</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">AdRenderer</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">getBannerByteArray</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">AdResult</span><span class="p">&lt;</span><span class="nc">ByteArray</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">path</span> <span class="p">=</span> <span class="nc">AssetPath</span><span class="p">.</span><span class="nf">fromURL</span><span class="p">(</span>
            <span class="n">folder</span> <span class="p">=</span> <span class="s">"TutorialRendererResources"</span><span class="p">,</span> <span class="c1">// Optional</span>
            <span class="n">url</span> <span class="p">=</span> <span class="n">url</span>
        <span class="p">)</span>

        <span class="c1">// cache.remove(path)</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-9-1"> <a href="#step-9-1" class="anchor-heading" aria-labelledby="step-9-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 9 </h3> <p>The final step is to pass <a href="ad_sdk/com.adition.ad_sdk.api.services.cache/-asset-cache/index.html">AssetCache</a> and <a href="ad_sdk/com.adition.ad_sdk.api.services.asset_request_service/-asset-request-service/index.html">AssetRequestService</a> from <a href="ad_sdk/com.adition.ad_sdk.api.core/-ad-renderer/-service-locator/index.html">AdRenderer.ServiceLocator</a> instead of <a href="ad_sdk/com.adition.ad_sdk.api.services.asset_repository/-asset-repository/index.html">AssetRepository</a> in <code class="language-plaintext highlighter-rouge">MainScreen.kt</code>.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">MainScreen.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="kd">class</span> <span class="nc">MainViewModel</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">adServiceProvider</span><span class="p">:</span> <span class="nc">AdServiceProviderInterface</span> <span class="p">=</span> <span class="nc">ServiceLocator</span><span class="p">.</span><span class="n">adServiceProvider</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">fun</span> <span class="nf">onLoad</span><span class="p">(</span><span class="n">isDataCollectionAllowed</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="n">adServiceProvider</span>
                <span class="p">.</span><span class="nf">configure</span><span class="p">(</span>
                    <span class="s">"1800"</span><span class="p">,</span>
                    <span class="n">parentCoroutineScope</span> <span class="p">=</span> <span class="k">this</span><span class="p">,</span>
                    <span class="n">cacheSize</span> <span class="p">=</span> <span class="mi">20u</span><span class="p">,</span>
                    <span class="n">globalParameters</span> <span class="p">=</span> <span class="n">globalParameters</span><span class="p">,</span>
                    <span class="n">adRequestGlobalParameters</span> <span class="p">=</span> <span class="n">adRequestGlobalParameters</span>
                <span class="p">)</span>
                <span class="c1">// ...</span>
                <span class="p">.</span><span class="nf">onSuccess</span> <span class="p">{</span> <span class="n">adService</span> <span class="p">-&gt;</span>
                    <span class="c1">// ...</span>
                <span class="p">}</span>
                <span class="p">.</span><span class="nf">onSuccess</span> <span class="p">{</span>
                    <span class="n">it</span><span class="p">.</span><span class="nf">registerRenderer</span><span class="p">(</span><span class="s">"tutorialad"</span><span class="p">)</span> <span class="p">{</span> <span class="n">serviceLocator</span> <span class="p">-&gt;</span>
                        <span class="nc">TutorialRenderer</span><span class="p">(</span>
                            <span class="n">cache</span> <span class="p">=</span> <span class="n">serviceLocator</span><span class="p">.</span><span class="n">assetCache</span><span class="p">,</span>
                            <span class="n">requestService</span> <span class="p">=</span> <span class="n">serviceLocator</span><span class="p">.</span><span class="n">assetRequestService</span><span class="p">,</span>
                            <span class="n">eventHandler</span> <span class="p">=</span> <span class="n">serviceLocator</span><span class="p">.</span><span class="n">eventHandler</span>
                        <span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="p">.</span><span class="k">get</span><span class="p">(</span>
                    <span class="n">onSuccess</span> <span class="p">=</span> <span class="p">{</span> <span class="n">_state</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="nc">PresentationState</span><span class="p">.</span><span class="nc">Loaded</span><span class="p">(</span><span class="nc">Unit</span><span class="p">)</span> <span class="p">},</span>
                    <span class="n">onError</span> <span class="p">=</span> <span class="p">{</span> <span class="n">_state</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="nc">PresentationState</span><span class="p">.</span><span class="nc">Error</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">description</span><span class="p">)</span> <span class="p">}</span>
                <span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
<span class="c1">// ...</span>
</code></pre></div></div> <p>Congratulations, we have implemented our own caching and loading logic!</p> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
