<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/nextgen-adsdk-android-release/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/nextgen-adsdk-android-release/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul:nth-of-type(1) > li > ul > li:not(:nth-child(6)) > a, .site-nav > ul:nth-of-type(1) > li > ul > li > ul > li a { background-image: none; } .site-nav > ul:not(:nth-of-type(1)) a, .site-nav li.external a { background-image: none; } .site-nav > ul:nth-of-type(1) > li > ul > li:nth-child(6) > a { font-weight: 600; text-decoration: none; } .site-nav > ul.nav-category-list > li > button svg, .site-nav > ul:nth-of-type(1) > li > ul > li:nth-child(6) > button svg { transform: rotate(-90deg); } .site-nav > ul.nav-category-list > li.nav-list-item > ul.nav-list, .site-nav > ul:nth-of-type(1) > li > ul > li.nav-list-item:nth-child(6) > ul.nav-list { display: block; } </style> <script src="/nextgen-adsdk-android-release/assets/js/vendor/lunr.min.js"></script> <script src="/nextgen-adsdk-android-release/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>User tagging and conversion tracking | AdSDK Documentation</title> <meta name="generator" content="Jekyll v3.10.0" /> <meta property="og:title" content="User tagging and conversion tracking" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="User tagging and conversion tracking" /> <meta property="og:description" content="User tagging and conversion tracking" /> <link rel="canonical" href="https://vm-mobile-sdk.github.io/nextgen-adsdk-android-release/6.0.0/user-tagging-conversion-tracking.html" /> <meta property="og:url" content="https://vm-mobile-sdk.github.io/nextgen-adsdk-android-release/6.0.0/user-tagging-conversion-tracking.html" /> <meta property="og:site_name" content="AdSDK Documentation" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="User tagging and conversion tracking" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"User tagging and conversion tracking","headline":"User tagging and conversion tracking","url":"https://vm-mobile-sdk.github.io/nextgen-adsdk-android-release/6.0.0/user-tagging-conversion-tracking.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/nextgen-adsdk-android-release/" class="site-title lh-tight"> AdSDK Documentation </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list nav-category-list"> <li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Toggle collection SDK v.6.0.0" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><div class="nav-category">SDK v.6.0.0</div> <ul class="nav-list"><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/meet-adsdk.html" class="nav-list-link">Meet nextgen AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/first-steps.html" class="nav-list-link">First steps for working with AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/create-and-display-inline-ads.html" class="nav-list-link">Create and display inline ads</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/create-and-display-interstitial-ad.html" class="nav-list-link">Create and display interstitial ad</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/handling-the-ad-events.html" class="nav-list-link">Handling the ad events</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/user-tagging-conversion-tracking.html" class="nav-list-link">User tagging and conversion tracking</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/global-request-parameters.html" class="nav-list-link">Global request parameters</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/cache-management.html" class="nav-list-link">AdSDK Cache Management</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/create-target-url-handler.html" class="nav-list-link">Custom handling of target tap URLs</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/creating-customised-advertising.html" class="nav-list-link">Creating customised advertising</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/compose_with_xml_guide.html" class="nav-list-link">How to use AdSDK with XML views</a></li></ul> </li> </ul> <ul class="nav-list nav-category-list"> <li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Toggle collection SDK v.5.3.0" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><div class="nav-category">SDK v.5.3.0</div> <ul class="nav-list"><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/meet-adsdk.html" class="nav-list-link">Meet nextgen AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/first-steps.html" class="nav-list-link">First steps for working with AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/create-and-display-inline-ads.html" class="nav-list-link">Create and display inline ads</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/create-and-display-interstitial-ad.html" class="nav-list-link">Create and display interstitial ad</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/handling-the-ad-events.html" class="nav-list-link">Handling the ad events</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/user-tagging-conversion-tracking.html" class="nav-list-link">User tagging and conversion tracking</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/global-request-parameters.html" class="nav-list-link">Global request parameters</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/cache-management.html" class="nav-list-link">AdSDK Cache Management</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/creating-customised-advertising.html" class="nav-list-link">Creating customised advertising</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/compose_with_xml_guide.html" class="nav-list-link">How to use AdSDK with XML views</a></li></ul> </li> </ul> <ul class="nav-list nav-category-list"> <li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Toggle collection SDK v.5.0.1" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><div class="nav-category">SDK v.5.0.1</div> <ul class="nav-list"><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/meet-adsdk.html" class="nav-list-link">Meet nextgen AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/first-steps.html" class="nav-list-link">First steps for working with AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/create-and-display-inline-ads.html" class="nav-list-link">Create and display inline ads</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/create-and-display-interstitial-ad.html" class="nav-list-link">Create and display interstitial ad</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/handling-the-ad-events.html" class="nav-list-link">Handling the ad events</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/user-tagging-conversion-tracking.html" class="nav-list-link">User tagging and conversion tracking</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/global-request-parameters.html" class="nav-list-link">Global request parameters</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/cache-management.html" class="nav-list-link">AdSDK Cache Management</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/creating-customised-advertising.html" class="nav-list-link">Creating customised advertising</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/compose_with_xml_guide.html" class="nav-list-link">How to use AdSDK with XML views</a></li></ul> </li> </ul> <ul class="nav-list nav-category-list"> <li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Toggle collection SDK v.5.0.0" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><div class="nav-category">SDK v.5.0.0</div> <ul class="nav-list"><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.0/meet-adsdk.html" class="nav-list-link">Meet nextgen AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.0/first-steps.html" class="nav-list-link">First steps for working with AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.0/create-and-display-inline-ads.html" class="nav-list-link">Create and display inline ads</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.0/create-and-display-interstitial-ad.html" class="nav-list-link">Create and display interstitial ad</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.0/handling-the-ad-events.html" class="nav-list-link">Handling the ad events</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.0/user-tagging-conversion-tracking.html" class="nav-list-link">User tagging and conversion tracking</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.0/global-request-parameters.html" class="nav-list-link">Global request parameters</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.0/cache-management.html" class="nav-list-link">AdSDK Cache Management</a></li></ul> </li> </ul> <ul class="nav-list nav-category-list"> <li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Toggle collection SDK v.4.6.0" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><div class="nav-category">SDK v.4.6.0</div> <ul class="nav-list"><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/4.6.0/meet-adsdk.html" class="nav-list-link">Meet nextgen AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/4.6.0/create-and-display-inline-ads.html" class="nav-list-link">Create and display inline ads</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/4.6.0/handling-the-state-and-events-of-advertising.html" class="nav-list-link">Handling the state and events of advertising</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/4.6.0/defining-the-size-of-the-advertisement.html" class="nav-list-link">Defining the size of the advertisement</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/4.6.0/create-and-display-interstitial-ad-section.html" class="nav-list-link">Create and display interstitial ad section</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/4.6.0/global-adRequest-parameters.html" class="nav-list-link">Global ad request parameters</a></li></ul> </li> </ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search AdSDK Documentation" aria-label="Search AdSDK Documentation" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <h1 id="user-tagging-and-conversion-tracking"> <a href="#user-tagging-and-conversion-tracking" class="anchor-heading" aria-labelledby="user-tagging-and-conversion-tracking"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> User tagging and conversion tracking </h1> <p>AdSDK provides powerful functionality for user tagging and conversion tracking. In this tutorial we will explore this functionality.</p> <p>We will continue to build the app, so be sure to follow all the previous tutorials. You can download this <a href="https://github.com/VM-Mobile-SDK/nextgen-adsdk-android-tutorial/tree/built-in-capabilities/tag-tracking-tutorial">project</a> which has already implemented all steps from this tutorial.</p> <h2 id="section-1-preparing-the-app"> <a href="#section-1-preparing-the-app" class="anchor-heading" aria-labelledby="section-1-preparing-the-app"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Section 1: Preparing the app </h2> <p>Before considering user tagging and conversion tracking, we need to prepare the application to have appropriate places to perform tagging and tracking. In this section, we will add an option to purchase the product shown in the inline ad.</p> <h3 id="step-1"> <a href="#step-1" class="anchor-heading" aria-labelledby="step-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1 </h3> <p>First, we will create a reusable component <code class="language-plaintext highlighter-rouge">LabeledContent</code> in <code class="language-plaintext highlighter-rouge">ui/components</code> that we will use in the future.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">LabeledContent.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Composable</span>
<span class="k">fun</span> <span class="nf">LabeledContent</span><span class="p">(</span>
    <span class="n">label</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">modifier</span><span class="p">:</span> <span class="nc">Modifier</span> <span class="p">=</span> <span class="nc">Modifier</span><span class="p">,</span>
    <span class="n">content</span><span class="p">:</span> <span class="nd">@Composable</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="nc">Unit</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="nc">Row</span><span class="p">(</span>
        <span class="n">modifier</span> <span class="p">=</span> <span class="n">modifier</span><span class="p">.</span><span class="nf">fillMaxWidth</span><span class="p">(),</span>
        <span class="n">horizontalArrangement</span> <span class="p">=</span> <span class="nc">Arrangement</span><span class="p">.</span><span class="nc">SpaceBetween</span><span class="p">,</span>
        <span class="n">verticalAlignment</span> <span class="p">=</span> <span class="nc">Alignment</span><span class="p">.</span><span class="nc">CenterVertically</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="nc">Text</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">fontWeight</span> <span class="p">=</span> <span class="nc">FontWeight</span><span class="p">.</span><span class="nc">Bold</span><span class="p">)</span>
        <span class="nf">content</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-2"> <a href="#step-2" class="anchor-heading" aria-labelledby="step-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2 </h3> <p>Let’s create a new <code class="language-plaintext highlighter-rouge">BasketScreen</code>, <code class="language-plaintext highlighter-rouge">BasketViewModel</code>, and <code class="language-plaintext highlighter-rouge">BasketRoute</code> in <code class="language-plaintext highlighter-rouge">presentation/screens</code>.</p> <p>In it, we create a screen where the user will buy the product, displaying the id, price, quantity, and total cost.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">BasketScreen.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Serializable</span>
<span class="kd">data class</span> <span class="nc">BasketRoute</span><span class="p">(</span><span class="kd">val</span> <span class="py">id</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="kd">val</span> <span class="py">price</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span>

<span class="nd">@Composable</span>
<span class="k">fun</span> <span class="nf">BasketScreen</span><span class="p">(</span>
    <span class="n">route</span><span class="p">:</span> <span class="nc">BasketRoute</span><span class="p">,</span>
    <span class="n">viewModel</span><span class="p">:</span> <span class="nc">BasketViewModel</span> <span class="p">=</span> <span class="nf">viewModel</span> <span class="p">{</span> <span class="nc">BasketViewModel</span><span class="p">(</span><span class="n">route</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">route</span><span class="p">.</span><span class="n">price</span><span class="p">)</span> <span class="p">},</span>
    <span class="n">navController</span><span class="p">:</span> <span class="nc">NavController</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">quantity</span> <span class="k">by</span> <span class="n">viewModel</span><span class="p">.</span><span class="n">quantity</span><span class="p">.</span><span class="nf">collectAsState</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">total</span> <span class="k">by</span> <span class="n">viewModel</span><span class="p">.</span><span class="n">total</span><span class="p">.</span><span class="nf">collectAsState</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">error</span> <span class="k">by</span> <span class="n">viewModel</span><span class="p">.</span><span class="n">error</span><span class="p">.</span><span class="nf">collectAsState</span><span class="p">()</span>

    <span class="nc">AppTopBarContainer</span><span class="p">(</span>
        <span class="n">title</span> <span class="p">=</span> <span class="s">"Basket"</span><span class="p">,</span>
        <span class="n">onNavigateBack</span> <span class="p">=</span> <span class="p">{</span> <span class="n">navController</span><span class="p">.</span><span class="nf">navigateUp</span><span class="p">()</span> <span class="p">}</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="nc">Column</span><span class="p">(</span>
            <span class="n">modifier</span> <span class="p">=</span> <span class="nc">Modifier</span>
                <span class="p">.</span><span class="nf">fillMaxSize</span><span class="p">()</span>
                <span class="p">.</span><span class="nf">padding</span><span class="p">(</span><span class="mi">16</span><span class="p">.</span><span class="n">dp</span><span class="p">),</span>
            <span class="n">verticalArrangement</span> <span class="p">=</span> <span class="nc">Arrangement</span><span class="p">.</span><span class="nf">spacedBy</span><span class="p">(</span><span class="mi">16</span><span class="p">.</span><span class="n">dp</span><span class="p">)</span>
        <span class="p">)</span> <span class="p">{</span>
            <span class="nc">LabeledContent</span><span class="p">(</span><span class="n">label</span> <span class="p">=</span> <span class="s">"Item id"</span><span class="p">)</span> <span class="p">{</span> <span class="nc">Text</span><span class="p">(</span><span class="n">viewModel</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="nf">toString</span><span class="p">())</span> <span class="p">}</span>
            <span class="nc">LabeledContent</span><span class="p">(</span><span class="n">label</span> <span class="p">=</span> <span class="s">"Price"</span><span class="p">)</span> <span class="p">{</span> <span class="nc">Text</span><span class="p">(</span><span class="s">"€${viewModel.price}"</span><span class="p">)</span> <span class="p">}</span>
            <span class="nc">LabeledContent</span><span class="p">(</span><span class="n">label</span> <span class="p">=</span> <span class="s">"Quantity"</span><span class="p">)</span> <span class="p">{</span> <span class="nc">Text</span><span class="p">(</span><span class="n">quantity</span><span class="p">.</span><span class="nf">toString</span><span class="p">())</span> <span class="p">}</span>
            <span class="nc">IconButton</span><span class="p">(</span><span class="n">onClick</span> <span class="p">=</span> <span class="p">{</span> <span class="n">viewModel</span><span class="p">.</span><span class="nf">onIncreaseQuantity</span><span class="p">()</span> <span class="p">})</span> <span class="p">{</span>
                <span class="nc">Icon</span><span class="p">(</span><span class="nc">Icons</span><span class="p">.</span><span class="nc">Default</span><span class="p">.</span><span class="nc">Add</span><span class="p">,</span> <span class="n">contentDescription</span> <span class="p">=</span> <span class="s">"Increase quantity"</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="nc">IconButton</span><span class="p">(</span><span class="n">onClick</span> <span class="p">=</span> <span class="p">{</span> <span class="n">viewModel</span><span class="p">.</span><span class="nf">onDecreaseQuantity</span><span class="p">()</span> <span class="p">})</span> <span class="p">{</span>
                <span class="nc">Icon</span><span class="p">(</span><span class="nc">Icons</span><span class="p">.</span><span class="nc">Default</span><span class="p">.</span><span class="nc">Remove</span><span class="p">,</span> <span class="n">contentDescription</span> <span class="p">=</span> <span class="s">"Decrease quantity"</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="nc">LabeledContent</span><span class="p">(</span><span class="n">label</span> <span class="p">=</span> <span class="s">"Total"</span><span class="p">)</span> <span class="p">{</span> <span class="nc">Text</span><span class="p">(</span><span class="s">"€$total"</span><span class="p">)</span> <span class="p">}</span>
            <span class="nc">Button</span><span class="p">(</span>
                <span class="n">onClick</span> <span class="p">=</span> <span class="p">{</span> <span class="n">viewModel</span><span class="p">.</span><span class="nf">onPurchase</span><span class="p">()</span> <span class="p">},</span>
                <span class="n">modifier</span> <span class="p">=</span> <span class="nc">Modifier</span><span class="p">.</span><span class="nf">fillMaxWidth</span><span class="p">()</span>
            <span class="p">)</span> <span class="p">{</span>
                <span class="nc">Text</span><span class="p">(</span><span class="s">"Purchase"</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="n">error</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span> <span class="n">errorMessage</span> <span class="p">-&gt;</span>
                <span class="nc">Text</span><span class="p">(</span>
                    <span class="n">text</span> <span class="p">=</span> <span class="n">errorMessage</span><span class="p">,</span>
                    <span class="n">color</span> <span class="p">=</span> <span class="nc">Color</span><span class="p">.</span><span class="nc">Red</span>
                <span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">BasketViewModel</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">id</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">price</span><span class="p">:</span> <span class="nc">Int</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">_quantity</span> <span class="p">=</span> <span class="nc">MutableStateFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">_error</span> <span class="p">=</span> <span class="nc">MutableStateFlow</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">?&gt;(</span><span class="k">null</span><span class="p">)</span>

    <span class="kd">val</span> <span class="py">quantity</span> <span class="p">=</span> <span class="n">_quantity</span><span class="p">.</span><span class="nf">asStateFlow</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">error</span> <span class="p">=</span> <span class="n">_error</span><span class="p">.</span><span class="nf">asStateFlow</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">total</span><span class="p">:</span> <span class="nc">StateFlow</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">quantity</span>
        <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span> <span class="p">*</span> <span class="n">price</span> <span class="p">}</span>
        <span class="p">.</span><span class="nf">stateIn</span><span class="p">(</span><span class="n">viewModelScope</span><span class="p">,</span> <span class="nc">SharingStarted</span><span class="p">.</span><span class="nc">Eagerly</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>

    <span class="k">fun</span> <span class="nf">onIncreaseQuantity</span><span class="p">()</span> <span class="p">{</span> <span class="n">_quantity</span><span class="p">.</span><span class="n">value</span> <span class="p">+=</span> <span class="mi">1</span> <span class="p">}</span>
    <span class="k">fun</span> <span class="nf">onDecreaseQuantity</span><span class="p">()</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="n">quantity</span><span class="p">.</span><span class="n">value</span> <span class="p">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="n">_quantity</span><span class="p">.</span><span class="n">value</span> <span class="p">-=</span> <span class="mi">1</span> <span class="p">}</span>
    <span class="k">fun</span> <span class="nf">onPurchase</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-3"> <a href="#step-3" class="anchor-heading" aria-labelledby="step-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 3 </h3> <p>Now we return to the <code class="language-plaintext highlighter-rouge">AdItemState</code>. We add a random price for the product and pass <code class="language-plaintext highlighter-rouge">parentCoroutineScope</code> for future use.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">AdItem.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="kd">class</span> <span class="nc">AdItemState</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">id</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">adService</span><span class="p">:</span> <span class="nc">AdService</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">request</span><span class="p">:</span> <span class="nc">AdRequest</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">parentCoroutineScope</span><span class="p">:</span> <span class="nc">CoroutineScope</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="kd">val</span> <span class="py">price</span><span class="p">:</span> <span class="nc">Int</span> <span class="p">=</span> <span class="nc">Random</span><span class="p">.</span><span class="nf">nextInt</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">loadAdvertisement</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
<span class="c1">// ...</span>
</code></pre></div></div> <h3 id="step-4"> <a href="#step-4" class="anchor-heading" aria-labelledby="step-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 4 </h3> <p>The next step is to add price information and a button to the <code class="language-plaintext highlighter-rouge">AdItem</code> that will take us to the basket screen.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">AdItem.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Composable</span>
<span class="k">fun</span> <span class="nf">AdItem</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="nc">AdItemState</span><span class="p">,</span> <span class="n">navController</span><span class="p">:</span> <span class="nc">NavController</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">uiState</span> <span class="k">by</span> <span class="n">state</span><span class="p">.</span><span class="n">state</span><span class="p">.</span><span class="nf">collectAsState</span><span class="p">()</span>

    <span class="nc">PresentationStateContainer</span><span class="p">(</span>
        <span class="n">uiState</span><span class="p">,</span>
        <span class="n">modifier</span> <span class="p">=</span> <span class="nc">Modifier</span>
            <span class="p">.</span><span class="nf">fillMaxWidth</span><span class="p">()</span>
    <span class="p">)</span> <span class="p">{</span> <span class="n">data</span> <span class="p">-&gt;</span>
        <span class="nc">Column</span> <span class="p">{</span>
            <span class="nc">Box</span><span class="p">(</span>
                <span class="nc">Modifier</span>
                    <span class="p">.</span><span class="nf">fillMaxWidth</span><span class="p">()</span>
                    <span class="p">.</span><span class="nf">aspectRatio</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">aspectRatio</span> <span class="o">?:</span> <span class="mf">2.0f</span><span class="p">)</span>
            <span class="p">)</span> <span class="p">{</span>
                <span class="nc">Ad</span><span class="p">(</span>
                    <span class="n">advertisement</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="n">advertisement</span><span class="p">,</span>
                    <span class="nc">Modifier</span>
                        <span class="p">.</span><span class="nf">fillMaxWidth</span><span class="p">()</span>
                        <span class="p">.</span><span class="nf">aspectRatio</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">aspectRatio</span> <span class="o">?:</span> <span class="mf">2.0f</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">}</span>

            <span class="nc">LabeledContent</span><span class="p">(</span>
                <span class="s">"Price: €${state.price}"</span><span class="p">,</span>
                <span class="nc">Modifier</span><span class="p">.</span><span class="nf">padding</span><span class="p">(</span><span class="mi">15</span><span class="p">.</span><span class="n">dp</span><span class="p">)</span>
            <span class="p">)</span> <span class="p">{</span>
                <span class="nc">Button</span><span class="p">(</span><span class="n">onClick</span> <span class="p">=</span> <span class="p">{</span>
                    <span class="n">navController</span><span class="p">.</span><span class="nf">navigate</span><span class="p">(</span>
                        <span class="nc">BasketRoute</span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">state</span><span class="p">.</span><span class="n">price</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">})</span> <span class="p">{</span>
                    <span class="nc">Text</span><span class="p">(</span><span class="s">"Add to basket"</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// ...</span>
</code></pre></div></div> <h3 id="step-5"> <a href="#step-5" class="anchor-heading" aria-labelledby="step-5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 5 </h3> <p>Now we fix the errors in <code class="language-plaintext highlighter-rouge">InlineScreen.kt</code> after previous changes.</p> <p>We pass <code class="language-plaintext highlighter-rouge">navController</code> to <code class="language-plaintext highlighter-rouge">AdItem</code> and <code class="language-plaintext highlighter-rouge">viewModelScope</code> to <code class="language-plaintext highlighter-rouge">AdItemState</code>.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">InlineScreen.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="nd">@Composable</span>
<span class="k">fun</span> <span class="nf">InlineScreen</span><span class="p">(</span>
    <span class="n">viewModel</span><span class="p">:</span> <span class="nc">InlineViewModel</span> <span class="p">=</span> <span class="nf">viewModel</span><span class="p">(),</span>
    <span class="n">navController</span><span class="p">:</span> <span class="nc">NavController</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">uiState</span> <span class="k">by</span> <span class="n">viewModel</span><span class="p">.</span><span class="n">state</span><span class="p">.</span><span class="nf">collectAsState</span><span class="p">()</span>

    <span class="nc">PresentationStateContainer</span><span class="p">(</span>
        <span class="n">uiState</span><span class="p">,</span>
        <span class="nc">Modifier</span><span class="p">.</span><span class="nf">fillMaxSize</span><span class="p">()</span>
    <span class="p">)</span> <span class="p">{</span> <span class="n">dataSource</span> <span class="p">-&gt;</span>
        <span class="nc">AppTopBarContainer</span><span class="p">(</span>
            <span class="n">title</span> <span class="p">=</span> <span class="s">"Inline Screen"</span><span class="p">,</span>
            <span class="n">onNavigateBack</span> <span class="p">=</span> <span class="p">{</span> <span class="n">navController</span><span class="p">.</span><span class="nf">navigateUp</span><span class="p">()</span> <span class="p">}</span>
        <span class="p">)</span> <span class="p">{</span>
            <span class="nc">LazyColumn</span><span class="p">(</span>
                <span class="n">modifier</span> <span class="p">=</span> <span class="nc">Modifier</span><span class="p">.</span><span class="nf">fillMaxSize</span><span class="p">()</span>
            <span class="p">)</span> <span class="p">{</span>
                <span class="nf">items</span><span class="p">(</span>
                    <span class="n">dataSource</span><span class="p">,</span>
                    <span class="n">key</span> <span class="p">=</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">id</span> <span class="p">}</span>
                <span class="p">)</span> <span class="p">{</span> <span class="n">itemState</span> <span class="p">-&gt;</span>
                    <span class="nc">AdItem</span><span class="p">(</span><span class="n">itemState</span><span class="p">,</span> <span class="n">navController</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">InlineViewModel</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">adService</span><span class="p">:</span> <span class="nc">AdService</span> <span class="p">=</span> <span class="nc">ServiceLocator</span><span class="p">.</span><span class="n">adService</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">getDataSource</span><span class="p">():</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">AdItemState</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">supervisorScope</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="n">requests</span>
            <span class="p">.</span><span class="nf">mapIndexed</span> <span class="p">{</span> <span class="n">index</span><span class="p">,</span> <span class="n">request</span> <span class="p">-&gt;</span>
                <span class="nf">async</span> <span class="p">{</span>
                    <span class="kd">val</span> <span class="py">itemState</span> <span class="p">=</span> <span class="nc">AdItemState</span><span class="p">(</span>
                        <span class="n">index</span><span class="p">,</span>
                        <span class="n">adService</span><span class="p">,</span>
                        <span class="n">request</span><span class="p">,</span>
                        <span class="n">viewModelScope</span>
                    <span class="p">)</span>

                    <span class="n">itemState</span><span class="p">.</span><span class="nf">loadAdvertisement</span><span class="p">()</span>
                    <span class="n">itemState</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="p">.</span><span class="nf">awaitAll</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-6"> <a href="#step-6" class="anchor-heading" aria-labelledby="step-6"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 6 </h3> <p>And finally, as a last step, we add <code class="language-plaintext highlighter-rouge">BasketRoute</code> to navigation.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">MainActivity.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">MainActivity</span> <span class="p">:</span> <span class="nc">ComponentActivity</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">.</span><span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>
        <span class="nf">enableEdgeToEdge</span><span class="p">()</span>
        <span class="nf">setContent</span> <span class="p">{</span>
            <span class="nc">TutorialAppTheme</span> <span class="p">{</span>
                <span class="kd">val</span> <span class="py">navController</span> <span class="p">=</span> <span class="nf">rememberNavController</span><span class="p">()</span>

                <span class="nc">NavHost</span><span class="p">(</span>
                    <span class="n">navController</span> <span class="p">=</span> <span class="n">navController</span><span class="p">,</span>
                    <span class="n">startDestination</span> <span class="p">=</span> <span class="nc">MainRoute</span>
                <span class="p">)</span> <span class="p">{</span>
                    <span class="n">composable</span><span class="p">&lt;</span><span class="nc">MainRoute</span><span class="p">&gt;</span> <span class="p">{</span> <span class="nc">MainScreen</span><span class="p">(</span><span class="n">navController</span> <span class="p">=</span> <span class="n">navController</span><span class="p">)</span> <span class="p">}</span>
                    <span class="n">composable</span><span class="p">&lt;</span><span class="nc">InlineRoute</span><span class="p">&gt;</span> <span class="p">{</span> <span class="nc">InlineScreen</span><span class="p">(</span><span class="n">navController</span> <span class="p">=</span> <span class="n">navController</span><span class="p">)</span> <span class="p">}</span>
                    <span class="n">composable</span><span class="p">&lt;</span><span class="nc">InterstitialRoute</span><span class="p">&gt;</span> <span class="p">{</span>
                        <span class="nc">InterstitialScreen</span><span class="p">(</span><span class="n">navController</span> <span class="p">=</span> <span class="n">navController</span><span class="p">)</span>
                    <span class="p">}</span>
                    <span class="n">composable</span><span class="p">&lt;</span><span class="nc">BasketRoute</span><span class="p">&gt;</span> <span class="p">{</span>
                        <span class="kd">val</span> <span class="py">route</span> <span class="p">=</span> <span class="n">it</span><span class="p">.</span><span class="n">toRoute</span><span class="p">&lt;</span><span class="nc">BasketRoute</span><span class="p">&gt;()</span>
                        <span class="nc">BasketScreen</span><span class="p">(</span><span class="n">route</span> <span class="p">=</span> <span class="n">route</span><span class="p">,</span> <span class="n">navController</span> <span class="p">=</span> <span class="n">navController</span><span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Now our app is ready to create purchases!</p> <h2 id="section-2-user-tagging"> <a href="#section-2-user-tagging" class="anchor-heading" aria-labelledby="section-2-user-tagging"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Section 2: User tagging </h2> <p>The SDK provides functionality to put a user identifier, e.g. cookie id, into a retargeting segment (to tag a user). This allows advertisers to create a segment of users with certain interests or affinities, and to re-advertise to this segment (retargeting). In this section, we will look at how we can perform a tag request using the AdSDK.</p> <h3 id="step-1-1"> <a href="#step-1-1" class="anchor-heading" aria-labelledby="step-1-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1 </h3> <p>Let’s continue with the <code class="language-plaintext highlighter-rouge">AdItem.kt</code> file. Let’s imagine a situation where we need to tag a user when he adds an item to the basket.</p> <p>To do this, first of all, we add the <code class="language-plaintext highlighter-rouge">onBasket</code> method to the <code class="language-plaintext highlighter-rouge">AdItemState</code>, and call it when the basket button is tapped.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">AdItem.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Composable</span>
<span class="k">fun</span> <span class="nf">AdItem</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="nc">AdItemState</span><span class="p">,</span> <span class="n">navController</span><span class="p">:</span> <span class="nc">NavController</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">uiState</span> <span class="k">by</span> <span class="n">state</span><span class="p">.</span><span class="n">state</span><span class="p">.</span><span class="nf">collectAsState</span><span class="p">()</span>

    <span class="nc">PresentationStateContainer</span><span class="p">(</span>
        <span class="n">uiState</span><span class="p">,</span>
        <span class="n">modifier</span> <span class="p">=</span> <span class="nc">Modifier</span>
            <span class="p">.</span><span class="nf">fillMaxWidth</span><span class="p">()</span>
    <span class="p">)</span> <span class="p">{</span> <span class="n">data</span> <span class="p">-&gt;</span>
        <span class="nc">Column</span> <span class="p">{</span>
            <span class="c1">// ...</span>

            <span class="nc">LabeledContent</span><span class="p">(</span>
                <span class="s">"Price: €${state.price}"</span><span class="p">,</span>
                <span class="nc">Modifier</span><span class="p">.</span><span class="nf">padding</span><span class="p">(</span><span class="mi">15</span><span class="p">.</span><span class="n">dp</span><span class="p">)</span>
            <span class="p">)</span> <span class="p">{</span>
                <span class="nc">Button</span><span class="p">(</span><span class="n">onClick</span> <span class="p">=</span> <span class="p">{</span>
                    <span class="n">state</span><span class="p">.</span><span class="nf">onBasket</span><span class="p">()</span>
                    <span class="n">navController</span><span class="p">.</span><span class="nf">navigate</span><span class="p">(</span>
                        <span class="nc">BasketRoute</span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">state</span><span class="p">.</span><span class="n">price</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">})</span> <span class="p">{</span>
                    <span class="nc">Text</span><span class="p">(</span><span class="s">"Add to basket"</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">AdItemState</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">id</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">adService</span><span class="p">:</span> <span class="nc">AdService</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">request</span><span class="p">:</span> <span class="nc">AdRequest</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">parentCoroutineScope</span><span class="p">:</span> <span class="nc">CoroutineScope</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">_state</span> <span class="p">=</span> <span class="nc">MutableStateFlow</span><span class="p">&lt;</span><span class="nc">PresentationState</span><span class="p">&lt;</span><span class="nc">ItemData</span><span class="p">&gt;&gt;(</span><span class="nc">PresentationState</span><span class="p">.</span><span class="nc">Loading</span><span class="p">)</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">advertisement</span><span class="p">:</span> <span class="nc">Advertisement</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>

    <span class="kd">val</span> <span class="py">state</span> <span class="p">=</span> <span class="n">_state</span><span class="p">.</span><span class="nf">asStateFlow</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">price</span><span class="p">:</span> <span class="nc">Int</span> <span class="p">=</span> <span class="nc">Random</span><span class="p">.</span><span class="nf">nextInt</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">fun</span> <span class="nf">onBasket</span><span class="p">()</span> <span class="p">{</span>

    <span class="p">}</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
<span class="c1">// ...</span>
</code></pre></div></div> <h3 id="step-2-1"> <a href="#step-2-1" class="anchor-heading" aria-labelledby="step-2-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2 </h3> <p>Now we’re ready to tag the user. You use <a href="ad_sdk/com.adition.ad_sdk.api.entities.request/-tag-request/index.html">TagRequest</a> to describe the tagging request. It consists of <a href="ad_sdk/com.adition.ad_sdk.api.entities.request/-tag-request/-tag/index.html">TagRequest.Tag</a>s with a key, a subkey, and a value. In our case, we’ll use key as the name of our store, subkey as the product category, and value as our product id.</p> <p><strong>Note:</strong> In real projects, the advertiser should provide you with information on the tag parameters.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">AdItem.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="kd">class</span> <span class="nc">AdItemState</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">id</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">adService</span><span class="p">:</span> <span class="nc">AdService</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">request</span><span class="p">:</span> <span class="nc">AdRequest</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">parentCoroutineScope</span><span class="p">:</span> <span class="nc">CoroutineScope</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">fun</span> <span class="nf">onBasket</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">request</span> <span class="p">=</span> <span class="nc">TagRequest</span><span class="p">(</span>
            <span class="n">tags</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>
                <span class="nc">TagRequest</span><span class="p">.</span><span class="nc">Tag</span><span class="p">(</span>
                    <span class="n">key</span> <span class="p">=</span> <span class="s">"MyTutorialStore"</span><span class="p">,</span>
                    <span class="n">subKey</span> <span class="p">=</span> <span class="s">"Movies"</span><span class="p">,</span>
                    <span class="n">value</span> <span class="p">=</span> <span class="s">"$id"</span>
                <span class="p">)</span>
            <span class="p">),</span>
            <span class="n">timeout</span> <span class="p">=</span> <span class="k">null</span> <span class="c1">// Can be skipped</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// ...</span>
</code></pre></div></div> <h3 id="step-3-1"> <a href="#step-3-1" class="anchor-heading" aria-labelledby="step-3-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 3 </h3> <p>You can perform a user tagging request with <a href="ad_sdk/com.adition.ad_sdk.api.core/-ad-service/tag-user.html">AdService.tagUser</a> method.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">AdItem.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="kd">class</span> <span class="nc">AdItemState</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">id</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">adService</span><span class="p">:</span> <span class="nc">AdService</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">request</span><span class="p">:</span> <span class="nc">AdRequest</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">parentCoroutineScope</span><span class="p">:</span> <span class="nc">CoroutineScope</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">fun</span> <span class="nf">onBasket</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">request</span> <span class="p">=</span> <span class="nc">TagRequest</span><span class="p">(</span>
            <span class="n">tags</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>
                <span class="nc">TagRequest</span><span class="p">.</span><span class="nc">Tag</span><span class="p">(</span>
                    <span class="n">key</span> <span class="p">=</span> <span class="s">"MyTutorialStore"</span><span class="p">,</span>
                    <span class="n">subKey</span> <span class="p">=</span> <span class="s">"Movies"</span><span class="p">,</span>
                    <span class="n">value</span> <span class="p">=</span> <span class="s">"$id"</span>
                <span class="p">)</span>
            <span class="p">),</span>
            <span class="n">timeout</span> <span class="p">=</span> <span class="k">null</span> <span class="c1">// Can be skipped</span>
        <span class="p">)</span>

        <span class="n">parentCoroutineScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span> 
            <span class="n">adService</span><span class="p">.</span><span class="nf">tagUser</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
                <span class="p">.</span><span class="k">get</span><span class="p">(</span>
                    <span class="n">onSuccess</span> <span class="p">=</span> <span class="p">{</span> 
                        <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"AdItemState"</span><span class="p">,</span> <span class="s">"Successfully tagged user for item $id"</span><span class="p">)</span> 
                    <span class="p">},</span>
                    <span class="n">onError</span> <span class="p">=</span> <span class="p">{</span>
                        <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"AdItemState"</span><span class="p">,</span> <span class="s">"Failed to tag user for item $id: ${it.description}"</span><span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// ...</span>
</code></pre></div></div> <p>Congratulations, now our app can tag the user who added the item to the basket!</p> <h2 id="section-3-conversion-tracking"> <a href="#section-3-conversion-tracking" class="anchor-heading" aria-labelledby="section-3-conversion-tracking"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Section 3: Conversion tracking </h2> <p>The SDK allows you to track conversions. This is useful for advertisers, as conversion details would be available in posttracking reports via the adserver. In this section, we will look at how we can perform a tracking request using the AdSDK.</p> <h3 id="step-1-2"> <a href="#step-1-2" class="anchor-heading" aria-labelledby="step-1-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1 </h3> <p>Let’s open the <code class="language-plaintext highlighter-rouge">BasketScreen.kt</code> file and focus on the <code class="language-plaintext highlighter-rouge">BasketViewModel</code>.</p> <p>The conversion, in our case, is the purchase of an item in the basket.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">BasketScreen.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="kd">class</span> <span class="nc">BasketViewModel</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">id</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">price</span><span class="p">:</span> <span class="nc">Int</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">_quantity</span> <span class="p">=</span> <span class="nc">MutableStateFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">_error</span> <span class="p">=</span> <span class="nc">MutableStateFlow</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">?&gt;(</span><span class="k">null</span><span class="p">)</span>

    <span class="kd">val</span> <span class="py">quantity</span> <span class="p">=</span> <span class="n">_quantity</span><span class="p">.</span><span class="nf">asStateFlow</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">error</span> <span class="p">=</span> <span class="n">_error</span><span class="p">.</span><span class="nf">asStateFlow</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">total</span><span class="p">:</span> <span class="nc">StateFlow</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">quantity</span>
        <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span> <span class="p">*</span> <span class="n">price</span> <span class="p">}</span>
        <span class="p">.</span><span class="nf">stateIn</span><span class="p">(</span><span class="n">viewModelScope</span><span class="p">,</span> <span class="nc">SharingStarted</span><span class="p">.</span><span class="nc">Eagerly</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>

    <span class="k">fun</span> <span class="nf">onIncreaseQuantity</span><span class="p">()</span> <span class="p">{</span> <span class="n">_quantity</span><span class="p">.</span><span class="n">value</span> <span class="p">+=</span> <span class="mi">1</span> <span class="p">}</span>
    <span class="k">fun</span> <span class="nf">onDecreaseQuantity</span><span class="p">()</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="n">quantity</span><span class="p">.</span><span class="n">value</span> <span class="p">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="n">_quantity</span><span class="p">.</span><span class="n">value</span> <span class="p">-=</span> <span class="mi">1</span> <span class="p">}</span>
    <span class="k">fun</span> <span class="nf">onPurchase</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-2-2"> <a href="#step-2-2" class="anchor-heading" aria-labelledby="step-2-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2 </h3> <p>A conversion tracking request is described using <a href="ad_sdk/com.adition.ad_sdk.api.entities.request/-tracking-request/index.html">TrackingRequest</a>. In it, we pass all the parameters related to the purchase.</p> <p><strong>Note:</strong> In real projects, the advertiser should provide you with information on the <code class="language-plaintext highlighter-rouge">landingpageId</code> and <code class="language-plaintext highlighter-rouge">trackingspotId</code> parameters.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">BasketScreen.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="kd">class</span> <span class="nc">BasketViewModel</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">id</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">price</span><span class="p">:</span> <span class="nc">Int</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">_quantity</span> <span class="p">=</span> <span class="nc">MutableStateFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">_error</span> <span class="p">=</span> <span class="nc">MutableStateFlow</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">?&gt;(</span><span class="k">null</span><span class="p">)</span>

    <span class="kd">val</span> <span class="py">quantity</span> <span class="p">=</span> <span class="n">_quantity</span><span class="p">.</span><span class="nf">asStateFlow</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">error</span> <span class="p">=</span> <span class="n">_error</span><span class="p">.</span><span class="nf">asStateFlow</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">total</span><span class="p">:</span> <span class="nc">StateFlow</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">quantity</span>
        <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span> <span class="p">*</span> <span class="n">price</span> <span class="p">}</span>
        <span class="p">.</span><span class="nf">stateIn</span><span class="p">(</span><span class="n">viewModelScope</span><span class="p">,</span> <span class="nc">SharingStarted</span><span class="p">.</span><span class="nc">Eagerly</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>

    <span class="k">fun</span> <span class="nf">onIncreaseQuantity</span><span class="p">()</span> <span class="p">{</span> <span class="n">_quantity</span><span class="p">.</span><span class="n">value</span> <span class="p">+=</span> <span class="mi">1</span> <span class="p">}</span>
    <span class="k">fun</span> <span class="nf">onDecreaseQuantity</span><span class="p">()</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="n">quantity</span><span class="p">.</span><span class="n">value</span> <span class="p">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="n">_quantity</span><span class="p">.</span><span class="n">value</span> <span class="p">-=</span> <span class="mi">1</span> <span class="p">}</span>
    <span class="k">fun</span> <span class="nf">onPurchase</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">request</span> <span class="p">=</span> <span class="nc">TrackingRequest</span><span class="p">(</span>
            <span class="n">landingPageId</span> <span class="p">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">trackingSpotId</span> <span class="p">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">orderId</span> <span class="p">=</span> <span class="s">"My purchase id"</span><span class="p">,</span> <span class="c1">// Can be skipped</span>
            <span class="n">price</span> <span class="p">=</span> <span class="n">price</span><span class="p">.</span><span class="nf">toFloat</span><span class="p">(),</span> <span class="c1">// Can be skipped</span>
            <span class="n">total</span> <span class="p">=</span> <span class="n">total</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="nf">toFloat</span><span class="p">(),</span> <span class="c1">// Can be skipped</span>
            <span class="n">quantity</span> <span class="p">=</span> <span class="n">quantity</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="c1">// Can be skipped</span>
            <span class="n">itemNumber</span> <span class="p">=</span> <span class="s">"$id"</span><span class="p">,</span> <span class="c1">// Can be skipped</span>
            <span class="n">description</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="c1">// Can be skipped</span>
            <span class="n">timeout</span> <span class="p">=</span> <span class="k">null</span> <span class="c1">// Can be skipped</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-3-2"> <a href="#step-3-2" class="anchor-heading" aria-labelledby="step-3-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 3 </h3> <p>Now we can perform the tracking request. We use <a href="ad_sdk/com.adition.ad_sdk.api.core/-ad-service/tracking-request.html">AdService.trackingRequest</a> for this purpose, and in case of an error, we display it on the screen.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">BasketScreen.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="kd">class</span> <span class="nc">BasketViewModel</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">id</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">price</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">adService</span><span class="p">:</span> <span class="nc">AdService</span> <span class="p">=</span> <span class="nc">ServiceLocator</span><span class="p">.</span><span class="n">adService</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">_quantity</span> <span class="p">=</span> <span class="nc">MutableStateFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">_error</span> <span class="p">=</span> <span class="nc">MutableStateFlow</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">?&gt;(</span><span class="k">null</span><span class="p">)</span>

    <span class="kd">val</span> <span class="py">quantity</span> <span class="p">=</span> <span class="n">_quantity</span><span class="p">.</span><span class="nf">asStateFlow</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">error</span> <span class="p">=</span> <span class="n">_error</span><span class="p">.</span><span class="nf">asStateFlow</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">total</span><span class="p">:</span> <span class="nc">StateFlow</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">quantity</span>
        <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span> <span class="p">*</span> <span class="n">price</span> <span class="p">}</span>
        <span class="p">.</span><span class="nf">stateIn</span><span class="p">(</span><span class="n">viewModelScope</span><span class="p">,</span> <span class="nc">SharingStarted</span><span class="p">.</span><span class="nc">Eagerly</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>

    <span class="k">fun</span> <span class="nf">onIncreaseQuantity</span><span class="p">()</span> <span class="p">{</span> <span class="n">_quantity</span><span class="p">.</span><span class="n">value</span> <span class="p">+=</span> <span class="mi">1</span> <span class="p">}</span>
    <span class="k">fun</span> <span class="nf">onDecreaseQuantity</span><span class="p">()</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="n">quantity</span><span class="p">.</span><span class="n">value</span> <span class="p">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="n">_quantity</span><span class="p">.</span><span class="n">value</span> <span class="p">-=</span> <span class="mi">1</span> <span class="p">}</span>
    <span class="k">fun</span> <span class="nf">onPurchase</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">request</span> <span class="p">=</span> <span class="nc">TrackingRequest</span><span class="p">(</span>
            <span class="n">landingPageId</span> <span class="p">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">trackingSpotId</span> <span class="p">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">orderId</span> <span class="p">=</span> <span class="s">"My purchase id"</span><span class="p">,</span> <span class="c1">// Can be skipped</span>
            <span class="n">price</span> <span class="p">=</span> <span class="n">price</span><span class="p">.</span><span class="nf">toFloat</span><span class="p">(),</span> <span class="c1">// Can be skipped</span>
            <span class="n">total</span> <span class="p">=</span> <span class="n">total</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="nf">toFloat</span><span class="p">(),</span> <span class="c1">// Can be skipped</span>
            <span class="n">quantity</span> <span class="p">=</span> <span class="n">quantity</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="c1">// Can be skipped</span>
            <span class="n">itemNumber</span> <span class="p">=</span> <span class="s">"$id"</span><span class="p">,</span> <span class="c1">// Can be skipped</span>
            <span class="n">description</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="c1">// Can be skipped</span>
            <span class="n">timeout</span> <span class="p">=</span> <span class="k">null</span> <span class="c1">// Can be skipped</span>
        <span class="p">)</span>

        <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="n">adService</span><span class="p">.</span><span class="nf">trackingRequest</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
                <span class="p">.</span><span class="k">get</span><span class="p">(</span>
                    <span class="n">onSuccess</span> <span class="p">=</span> <span class="p">{</span>
                        <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"BasketViewModel"</span><span class="p">,</span> <span class="s">"Successfully tracked purchase with id: $id"</span><span class="p">)</span>
                    <span class="p">},</span>
                    <span class="n">onError</span> <span class="p">=</span> <span class="p">{</span> <span class="n">_error</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="n">it</span><span class="p">.</span><span class="n">description</span> <span class="p">}</span>
                <span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Congratulations, our app can now track purchase!</p> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
