<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/nextgen-adsdk-android-release/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/nextgen-adsdk-android-release/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul:nth-of-type(4) > li > ul > li:not(:nth-child(6)) > a, .site-nav > ul:nth-of-type(4) > li > ul > li > ul > li a { background-image: none; } .site-nav > ul:not(:nth-of-type(4)) a, .site-nav li.external a { background-image: none; } .site-nav > ul:nth-of-type(4) > li > ul > li:nth-child(6) > a { font-weight: 600; text-decoration: none; } .site-nav > ul.nav-category-list > li > button svg, .site-nav > ul:nth-of-type(4) > li > ul > li:nth-child(6) > button svg { transform: rotate(-90deg); } .site-nav > ul.nav-category-list > li.nav-list-item > ul.nav-list, .site-nav > ul:nth-of-type(4) > li > ul > li.nav-list-item:nth-child(6) > ul.nav-list { display: block; } </style> <script src="/nextgen-adsdk-android-release/assets/js/vendor/lunr.min.js"></script> <script src="/nextgen-adsdk-android-release/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>User tagging and conversion tracking | AdSDK Documentation</title> <meta name="generator" content="Jekyll v3.10.0" /> <meta property="og:title" content="User tagging and conversion tracking" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="User tagging and conversion tracking" /> <meta property="og:description" content="User tagging and conversion tracking" /> <link rel="canonical" href="https://vm-mobile-sdk.github.io/nextgen-adsdk-android-release/5.0.0/user-tagging-conversion-tracking.html" /> <meta property="og:url" content="https://vm-mobile-sdk.github.io/nextgen-adsdk-android-release/5.0.0/user-tagging-conversion-tracking.html" /> <meta property="og:site_name" content="AdSDK Documentation" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="User tagging and conversion tracking" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"User tagging and conversion tracking","headline":"User tagging and conversion tracking","url":"https://vm-mobile-sdk.github.io/nextgen-adsdk-android-release/5.0.0/user-tagging-conversion-tracking.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/nextgen-adsdk-android-release/" class="site-title lh-tight"> AdSDK Documentation </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list nav-category-list"> <li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Toggle collection SDK v.6.0.0" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><div class="nav-category">SDK v.6.0.0</div> <ul class="nav-list"><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/meet-adsdk.html" class="nav-list-link">Meet nextgen AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/first-steps.html" class="nav-list-link">First steps for working with AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/create-and-display-inline-ads.html" class="nav-list-link">Create and display inline ads</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/create-and-display-interstitial-ad.html" class="nav-list-link">Create and display interstitial ad</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/handling-the-ad-events.html" class="nav-list-link">Handling the ad events</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/user-tagging-conversion-tracking.html" class="nav-list-link">User tagging and conversion tracking</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/global-request-parameters.html" class="nav-list-link">Global request parameters</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/cache-management.html" class="nav-list-link">AdSDK Cache Management</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/create-target-url-handler.html" class="nav-list-link">Custom handling of target tap URLs</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/creating-customised-advertising.html" class="nav-list-link">Creating customised advertising</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/6.0.0/compose_with_xml_guide.html" class="nav-list-link">How to use AdSDK with XML views</a></li></ul> </li> </ul> <ul class="nav-list nav-category-list"> <li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Toggle collection SDK v.5.3.0" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><div class="nav-category">SDK v.5.3.0</div> <ul class="nav-list"><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/meet-adsdk.html" class="nav-list-link">Meet nextgen AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/first-steps.html" class="nav-list-link">First steps for working with AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/create-and-display-inline-ads.html" class="nav-list-link">Create and display inline ads</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/create-and-display-interstitial-ad.html" class="nav-list-link">Create and display interstitial ad</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/handling-the-ad-events.html" class="nav-list-link">Handling the ad events</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/user-tagging-conversion-tracking.html" class="nav-list-link">User tagging and conversion tracking</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/global-request-parameters.html" class="nav-list-link">Global request parameters</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/cache-management.html" class="nav-list-link">AdSDK Cache Management</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/creating-customised-advertising.html" class="nav-list-link">Creating customised advertising</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.3.0/compose_with_xml_guide.html" class="nav-list-link">How to use AdSDK with XML views</a></li></ul> </li> </ul> <ul class="nav-list nav-category-list"> <li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Toggle collection SDK v.5.0.1" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><div class="nav-category">SDK v.5.0.1</div> <ul class="nav-list"><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/meet-adsdk.html" class="nav-list-link">Meet nextgen AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/first-steps.html" class="nav-list-link">First steps for working with AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/create-and-display-inline-ads.html" class="nav-list-link">Create and display inline ads</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/create-and-display-interstitial-ad.html" class="nav-list-link">Create and display interstitial ad</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/handling-the-ad-events.html" class="nav-list-link">Handling the ad events</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/user-tagging-conversion-tracking.html" class="nav-list-link">User tagging and conversion tracking</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/global-request-parameters.html" class="nav-list-link">Global request parameters</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/cache-management.html" class="nav-list-link">AdSDK Cache Management</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/creating-customised-advertising.html" class="nav-list-link">Creating customised advertising</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.1/compose_with_xml_guide.html" class="nav-list-link">How to use AdSDK with XML views</a></li></ul> </li> </ul> <ul class="nav-list nav-category-list"> <li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Toggle collection SDK v.5.0.0" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><div class="nav-category">SDK v.5.0.0</div> <ul class="nav-list"><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.0/meet-adsdk.html" class="nav-list-link">Meet nextgen AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.0/first-steps.html" class="nav-list-link">First steps for working with AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.0/create-and-display-inline-ads.html" class="nav-list-link">Create and display inline ads</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.0/create-and-display-interstitial-ad.html" class="nav-list-link">Create and display interstitial ad</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.0/handling-the-ad-events.html" class="nav-list-link">Handling the ad events</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.0/user-tagging-conversion-tracking.html" class="nav-list-link">User tagging and conversion tracking</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.0/global-request-parameters.html" class="nav-list-link">Global request parameters</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/5.0.0/cache-management.html" class="nav-list-link">AdSDK Cache Management</a></li></ul> </li> </ul> <ul class="nav-list nav-category-list"> <li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Toggle collection SDK v.4.6.0" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><div class="nav-category">SDK v.4.6.0</div> <ul class="nav-list"><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/4.6.0/meet-adsdk.html" class="nav-list-link">Meet nextgen AdSDK</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/4.6.0/create-and-display-inline-ads.html" class="nav-list-link">Create and display inline ads</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/4.6.0/handling-the-state-and-events-of-advertising.html" class="nav-list-link">Handling the state and events of advertising</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/4.6.0/defining-the-size-of-the-advertisement.html" class="nav-list-link">Defining the size of the advertisement</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/4.6.0/create-and-display-interstitial-ad-section.html" class="nav-list-link">Create and display interstitial ad section</a></li><li class="nav-list-item"><a href="/nextgen-adsdk-android-release/4.6.0/global-adRequest-parameters.html" class="nav-list-link">Global ad request parameters</a></li></ul> </li> </ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search AdSDK Documentation" aria-label="Search AdSDK Documentation" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <h1 id="user-tagging-and-conversion-tracking"> <a href="#user-tagging-and-conversion-tracking" class="anchor-heading" aria-labelledby="user-tagging-and-conversion-tracking"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> User tagging and conversion tracking </h1> <p>AdSDK provides powerful functionality for user tagging and conversion tracking. In this tutorial we will explore this functionality.</p> <p>We will continue to build the app, so be sure to follow all the previous tutorials. You can download this <a href="https://github.com/VM-Mobile-SDK/nextgen-adsdk-android-tutorial/tree/built-in-capabilities/tag-tracking-tutorial">project</a> which has already implemented all steps from this tutorial.</p> <h2 id="section-1-user-tagging"> <a href="#section-1-user-tagging" class="anchor-heading" aria-labelledby="section-1-user-tagging"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Section 1: User tagging </h2> <p>The SDK provides functionality to put a user identifier, such as a cookie id, into a retargeting segment (to tag a user). This allows advertisers to create a segment of users with certain interests or affinities, and to re-advertise to this segment (retargeting). In this section, we will look at how to perform a tag request using the AdSDK.</p> <h3 id="step-1"> <a href="#step-1" class="anchor-heading" aria-labelledby="step-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1 </h3> <p>To tag a user we need a <a href="sdk_core/com.adition.sdk_core.api.entities.request/-tag-request/index.html">TagRequest</a>, that describes the request for tagging and consists of tags with a key, a subkey, and a value.</p> <p>We keep it simple and just add a <code class="language-plaintext highlighter-rouge">tagUser()</code> method to the <code class="language-plaintext highlighter-rouge">InlineAdViewModel</code> and create a <a href="sdk_core/com.adition.sdk_core.api.entities.request/-tag-request/index.html">TagRequest</a> with one <a href="sdk_core/com.adition.sdk_core.api.entities.request/-tag-request/-tag/index.html">TagRequest.Tag</a>.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">InlineAd.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">InlineAdViewModel</span><span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">adRequest</span> <span class="p">=</span> <span class="nc">AdRequest</span><span class="p">(</span><span class="s">"4810915"</span><span class="p">)</span>
    <span class="kd">var</span> <span class="py">advertisementState</span> <span class="p">=</span> <span class="n">mutableStateOf</span><span class="p">&lt;</span><span class="nc">ResultState</span><span class="p">&lt;</span><span class="nc">Advertisement</span><span class="p">&gt;?&gt;(</span><span class="k">null</span><span class="p">)</span>
    <span class="kd">var</span> <span class="py">aspectRatio</span> <span class="p">=</span> <span class="mf">2f</span>

    <span class="c1">// ...</span>
    
    <span class="nf">init</span> <span class="p">{</span>
        <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="nf">tagUser</span><span class="p">()</span>

            <span class="c1">// ...</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">tagUser</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">tags</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="nc">TagRequest</span><span class="p">.</span><span class="nc">Tag</span><span class="p">(</span><span class="s">"segments"</span><span class="p">,</span> <span class="s">"category"</span><span class="p">,</span> <span class="s">"home"</span><span class="p">))</span>
        <span class="kd">val</span> <span class="py">request</span> <span class="p">=</span> <span class="nc">TagRequest</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-2"> <a href="#step-2" class="anchor-heading" aria-labelledby="step-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2 </h3> <p>We pass the <a href="sdk_core/com.adition.sdk_core.api.entities.request/-tag-request/index.html">TagRequest</a> to the <a href="sdk_core/com.adition.sdk_core.api.core/-ad-service/tag-user.html">AdService.tagUser</a>.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">InlineAd.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">InlineAdViewModel</span><span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">adRequest</span> <span class="p">=</span> <span class="nc">AdRequest</span><span class="p">(</span><span class="s">"4810915"</span><span class="p">)</span>
    <span class="kd">var</span> <span class="py">advertisementState</span> <span class="p">=</span> <span class="n">mutableStateOf</span><span class="p">&lt;</span><span class="nc">ResultState</span><span class="p">&lt;</span><span class="nc">Advertisement</span><span class="p">&gt;?&gt;(</span><span class="k">null</span><span class="p">)</span>
    <span class="kd">var</span> <span class="py">aspectRatio</span> <span class="p">=</span> <span class="mf">2f</span>

    <span class="c1">// ...</span>

    <span class="nf">init</span> <span class="p">{</span>
        <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="nf">tagUser</span><span class="p">()</span>

            <span class="c1">// ...</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">tagUser</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">tags</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="nc">TagRequest</span><span class="p">.</span><span class="nc">Tag</span><span class="p">(</span><span class="s">"segments"</span><span class="p">,</span> <span class="s">"category"</span><span class="p">,</span> <span class="s">"home"</span><span class="p">))</span>
        <span class="kd">val</span> <span class="py">request</span> <span class="p">=</span> <span class="nc">TagRequest</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>

        <span class="nc">AdService</span><span class="p">.</span><span class="nf">tagUser</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-3"> <a href="#step-3" class="anchor-heading" aria-labelledby="step-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 3 </h3> <p>The <a href="sdk_core/com.adition.sdk_core.api.core/-ad-service/tag-user.html">AdService.tagUser</a> method returns an <a href="sdk_core/com.adition.sdk_core.api.entities.exception/-ad-result/index.html">AdResult</a>, so let’s log the result.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">InlineAd.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">InlineAdViewModel</span><span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">adRequest</span> <span class="p">=</span> <span class="nc">AdRequest</span><span class="p">(</span><span class="s">"4810915"</span><span class="p">)</span>
    <span class="kd">var</span> <span class="py">advertisementState</span> <span class="p">=</span> <span class="n">mutableStateOf</span><span class="p">&lt;</span><span class="nc">ResultState</span><span class="p">&lt;</span><span class="nc">Advertisement</span><span class="p">&gt;?&gt;(</span><span class="k">null</span><span class="p">)</span>
    <span class="kd">var</span> <span class="py">aspectRatio</span> <span class="p">=</span> <span class="mf">2f</span>

    <span class="c1">// ...</span>

    <span class="nf">init</span> <span class="p">{</span>
        <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="nf">tagUser</span><span class="p">()</span>

            <span class="c1">// ...</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">tagUser</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">tags</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="nc">TagRequest</span><span class="p">.</span><span class="nc">Tag</span><span class="p">(</span><span class="s">"segments"</span><span class="p">,</span> <span class="s">"category"</span><span class="p">,</span> <span class="s">"home"</span><span class="p">))</span>
        <span class="kd">val</span> <span class="py">request</span> <span class="p">=</span> <span class="nc">TagRequest</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>

        <span class="nc">AdService</span><span class="p">.</span><span class="nf">tagUser</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="k">get</span><span class="p">(</span>
            <span class="n">onSuccess</span> <span class="p">=</span> <span class="p">{</span>
                <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"InlineAdViewModel"</span><span class="p">,</span> <span class="s">"User tagging was successful"</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="n">onError</span> <span class="p">=</span> <span class="p">{</span>
                <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"InlineAdViewModel"</span><span class="p">,</span> <span class="s">"Failed user tagging: ${it.description}"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-4"> <a href="#step-4" class="anchor-heading" aria-labelledby="step-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 4 </h3> <p>To make sure the user is tagged before we call <a href="sdk_core/com.adition.sdk_core.api.core/-ad-service/make-advertisement.html">AdService.makeAdvertisement</a>, we will use the <code class="language-plaintext highlighter-rouge">coroutines</code> <code class="language-plaintext highlighter-rouge">async</code> method.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">InlineAd.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">InlineAdViewModel</span><span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">adRequest</span> <span class="p">=</span> <span class="nc">AdRequest</span><span class="p">(</span><span class="s">"4810915"</span><span class="p">)</span>
    <span class="kd">var</span> <span class="py">advertisementState</span> <span class="p">=</span> <span class="n">mutableStateOf</span><span class="p">&lt;</span><span class="nc">ResultState</span><span class="p">&lt;</span><span class="nc">Advertisement</span><span class="p">&gt;?&gt;(</span><span class="k">null</span><span class="p">)</span>
    <span class="kd">var</span> <span class="py">aspectRatio</span> <span class="p">=</span> <span class="mf">2f</span>

    <span class="c1">// ...</span>

    <span class="nf">init</span> <span class="p">{</span>
        <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">tagUser</span> <span class="p">=</span> <span class="nf">async</span> <span class="p">{</span> <span class="nf">tagUser</span><span class="p">()</span> <span class="p">}</span>
            <span class="n">tagUser</span><span class="p">.</span><span class="nf">await</span><span class="p">()</span>

            <span class="c1">// ...</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">tagUser</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">tags</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="nc">TagRequest</span><span class="p">.</span><span class="nc">Tag</span><span class="p">(</span><span class="s">"segments"</span><span class="p">,</span> <span class="s">"category"</span><span class="p">,</span> <span class="s">"home"</span><span class="p">))</span>
        <span class="kd">val</span> <span class="py">request</span> <span class="p">=</span> <span class="nc">TagRequest</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>

        <span class="nc">AdService</span><span class="p">.</span><span class="nf">tagUser</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="k">get</span><span class="p">(</span>
            <span class="n">onSuccess</span> <span class="p">=</span> <span class="p">{</span>
                <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"InlineAdViewModel"</span><span class="p">,</span> <span class="s">"User tagging was successful"</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="n">onError</span> <span class="p">=</span> <span class="p">{</span>
                <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"InlineAdViewModel"</span><span class="p">,</span> <span class="s">"Failed user tagging: ${it.description}"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="section-2-conversion-tracking"> <a href="#section-2-conversion-tracking" class="anchor-heading" aria-labelledby="section-2-conversion-tracking"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Section 2: Conversion tracking </h2> <p>The SDK allows you to track conversions. This is useful for advertisers as conversion details are available in post tracking reports via the ad server. In this section we will look at how to perform a tracking request using the AdSDK.</p> <h3 id="step-1-1"> <a href="#step-1-1" class="anchor-heading" aria-labelledby="step-1-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1 </h3> <p>A conversion tracking request is described using <a href="sdk_core/com.adition.sdk_core.api.entities.request/-tracking-request/index.html">TrackingRequest</a>.</p> <p>We add a <code class="language-plaintext highlighter-rouge">conversionTracking()</code> function to the <code class="language-plaintext highlighter-rouge">InlineAdViewModel</code></p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">InlineAd.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">InlineAdViewModel</span><span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">adRequest</span> <span class="p">=</span> <span class="nc">AdRequest</span><span class="p">(</span><span class="s">"4810915"</span><span class="p">)</span>
    <span class="kd">var</span> <span class="py">advertisementState</span> <span class="p">=</span> <span class="n">mutableStateOf</span><span class="p">&lt;</span><span class="nc">ResultState</span><span class="p">&lt;</span><span class="nc">Advertisement</span><span class="p">&gt;?&gt;(</span><span class="k">null</span><span class="p">)</span>
    <span class="kd">var</span> <span class="py">aspectRatio</span> <span class="p">=</span> <span class="mf">2f</span>

    <span class="c1">// ...</span>

    <span class="nf">init</span> <span class="p">{</span>
        <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="nf">tagUser</span><span class="p">()</span>
            <span class="nf">conversionTracking</span><span class="p">()</span>

            <span class="c1">// ...</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">tagUser</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">tags</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="nc">TagRequest</span><span class="p">.</span><span class="nc">Tag</span><span class="p">(</span><span class="s">"segments"</span><span class="p">,</span> <span class="s">"category"</span><span class="p">,</span> <span class="s">"home"</span><span class="p">))</span>
        <span class="kd">val</span> <span class="py">request</span> <span class="p">=</span> <span class="nc">TagRequest</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>

        <span class="nc">AdService</span><span class="p">.</span><span class="nf">tagUser</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="k">get</span><span class="p">(</span>
            <span class="n">onSuccess</span> <span class="p">=</span> <span class="p">{</span>
                <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"InlineAdViewModel"</span><span class="p">,</span> <span class="s">"User tagging was successful"</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="n">onError</span> <span class="p">=</span> <span class="p">{</span>
                <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"InlineAdViewModel"</span><span class="p">,</span> <span class="s">"Failed user tagging: ${it.description}"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">conversionTracking</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">request</span> <span class="p">=</span> <span class="nc">TrackingRequest</span><span class="p">(</span>
            <span class="n">landingPageId</span> <span class="p">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">trackingSpotId</span> <span class="p">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">orderId</span> <span class="p">=</span> <span class="s">"orderId"</span><span class="p">,</span>
            <span class="n">itemNumber</span> <span class="p">=</span> <span class="s">"itemNumber"</span><span class="p">,</span>
            <span class="n">description</span> <span class="p">=</span> <span class="s">"description"</span><span class="p">,</span>
            <span class="n">quantity</span> <span class="p">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">price</span> <span class="p">=</span> <span class="mf">19.99f</span><span class="p">,</span>
            <span class="n">total</span> <span class="p">=</span> <span class="mf">39.98f</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-2-1"> <a href="#step-2-1" class="anchor-heading" aria-labelledby="step-2-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2 </h3> <p>We pass the <a href="sdk_core/com.adition.sdk_core.api.entities.request/-tracking-request/index.html">TrackingRequest</a> to the <a href="sdk_core/com.adition.sdk_core.api.core/-ad-service/tracking-request.html">AdService.trackingRequest</a>.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">InlineAd.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">InlineAdViewModel</span><span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">adRequest</span> <span class="p">=</span> <span class="nc">AdRequest</span><span class="p">(</span><span class="s">"4810915"</span><span class="p">)</span>
    <span class="kd">var</span> <span class="py">advertisementState</span> <span class="p">=</span> <span class="n">mutableStateOf</span><span class="p">&lt;</span><span class="nc">ResultState</span><span class="p">&lt;</span><span class="nc">Advertisement</span><span class="p">&gt;?&gt;(</span><span class="k">null</span><span class="p">)</span>
    <span class="kd">var</span> <span class="py">aspectRatio</span> <span class="p">=</span> <span class="mf">2f</span>

    <span class="c1">// ...</span>

    <span class="nf">init</span> <span class="p">{</span>
        <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="nf">tagUser</span><span class="p">()</span>
            <span class="nf">conversionTracking</span><span class="p">()</span>

            <span class="c1">// ...</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">tagUser</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">tags</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="nc">TagRequest</span><span class="p">.</span><span class="nc">Tag</span><span class="p">(</span><span class="s">"segments"</span><span class="p">,</span> <span class="s">"category"</span><span class="p">,</span> <span class="s">"home"</span><span class="p">))</span>
        <span class="kd">val</span> <span class="py">request</span> <span class="p">=</span> <span class="nc">TagRequest</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>

        <span class="nc">AdService</span><span class="p">.</span><span class="nf">tagUser</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="k">get</span><span class="p">(</span>
            <span class="n">onSuccess</span> <span class="p">=</span> <span class="p">{</span>
                <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"InlineAdViewModel"</span><span class="p">,</span> <span class="s">"User tagging was successful"</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="n">onError</span> <span class="p">=</span> <span class="p">{</span>
                <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"InlineAdViewModel"</span><span class="p">,</span> <span class="s">"Failed user tagging: ${it.description}"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">conversionTracking</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">request</span> <span class="p">=</span> <span class="nc">TrackingRequest</span><span class="p">(</span>
            <span class="n">landingPageId</span> <span class="p">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">trackingSpotId</span> <span class="p">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">orderId</span> <span class="p">=</span> <span class="s">"orderId"</span><span class="p">,</span>
            <span class="n">itemNumber</span> <span class="p">=</span> <span class="s">"itemNumber"</span><span class="p">,</span>
            <span class="n">description</span> <span class="p">=</span> <span class="s">"description"</span><span class="p">,</span>
            <span class="n">quantity</span> <span class="p">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">price</span> <span class="p">=</span> <span class="mf">19.99f</span><span class="p">,</span>
            <span class="n">total</span> <span class="p">=</span> <span class="mf">39.98f</span>
        <span class="p">)</span>

        <span class="nc">AdService</span><span class="p">.</span><span class="nf">trackingRequest</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-3-1"> <a href="#step-3-1" class="anchor-heading" aria-labelledby="step-3-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 3 </h3> <p>The <a href="sdk_core/com.adition.sdk_core.api.core/-ad-service/tracking-request.html">AdService.trackingRequest</a> method also returns an <a href="sdk_core/com.adition.sdk_core.api.entities.exception/-ad-result/index.html">AdResult</a>, so let’s log the result.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">InlineAd.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">InlineAdViewModel</span><span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">adRequest</span> <span class="p">=</span> <span class="nc">AdRequest</span><span class="p">(</span><span class="s">"4810915"</span><span class="p">)</span>
    <span class="kd">var</span> <span class="py">advertisementState</span> <span class="p">=</span> <span class="n">mutableStateOf</span><span class="p">&lt;</span><span class="nc">ResultState</span><span class="p">&lt;</span><span class="nc">Advertisement</span><span class="p">&gt;?&gt;(</span><span class="k">null</span><span class="p">)</span>
    <span class="kd">var</span> <span class="py">aspectRatio</span> <span class="p">=</span> <span class="mf">2f</span>

    <span class="c1">// ...</span>

    <span class="nf">init</span> <span class="p">{</span>
        <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="nf">tagUser</span><span class="p">()</span>
            <span class="nf">conversionTracking</span><span class="p">()</span>

            <span class="c1">// ...</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">tagUser</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">tags</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="nc">TagRequest</span><span class="p">.</span><span class="nc">Tag</span><span class="p">(</span><span class="s">"segments"</span><span class="p">,</span> <span class="s">"category"</span><span class="p">,</span> <span class="s">"home"</span><span class="p">))</span>
        <span class="kd">val</span> <span class="py">request</span> <span class="p">=</span> <span class="nc">TagRequest</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>

        <span class="nc">AdService</span><span class="p">.</span><span class="nf">tagUser</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="k">get</span><span class="p">(</span>
            <span class="n">onSuccess</span> <span class="p">=</span> <span class="p">{</span>
                <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"InlineAdViewModel"</span><span class="p">,</span> <span class="s">"User tagging was successful"</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="n">onError</span> <span class="p">=</span> <span class="p">{</span>
                <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"InlineAdViewModel"</span><span class="p">,</span> <span class="s">"Failed user tagging: ${it.description}"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">conversionTracking</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">request</span> <span class="p">=</span> <span class="nc">TrackingRequest</span><span class="p">(</span>
            <span class="n">landingPageId</span> <span class="p">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">trackingSpotId</span> <span class="p">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">orderId</span> <span class="p">=</span> <span class="s">"orderId"</span><span class="p">,</span>
            <span class="n">itemNumber</span> <span class="p">=</span> <span class="s">"itemNumber"</span><span class="p">,</span>
            <span class="n">description</span> <span class="p">=</span> <span class="s">"description"</span><span class="p">,</span>
            <span class="n">quantity</span> <span class="p">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">price</span> <span class="p">=</span> <span class="mf">19.99f</span><span class="p">,</span>
            <span class="n">total</span> <span class="p">=</span> <span class="mf">39.98f</span>
        <span class="p">)</span>

        <span class="nc">AdService</span><span class="p">.</span><span class="nf">trackingRequest</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="k">get</span><span class="p">(</span>
            <span class="n">onSuccess</span> <span class="p">=</span> <span class="p">{</span>
                <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"InlineAdViewModel"</span><span class="p">,</span> <span class="s">"Conversion tracking was successful"</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="n">onError</span> <span class="p">=</span> <span class="p">{</span>
                <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"InlineAdViewModel"</span><span class="p">,</span> <span class="s">"Failed conversion tracking: ${it.description}"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="step-4-1"> <a href="#step-4-1" class="anchor-heading" aria-labelledby="step-4-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 4 </h3> <p>To ensure that the conversion tracking is done before we call the <a href="sdk_core/com.adition.sdk_core.api.core/-ad-service/make-advertisement.html">AdService.makeAdvertisement</a> method, we will use the <code class="language-plaintext highlighter-rouge">coroutines</code> <code class="language-plaintext highlighter-rouge">async</code> method.</p> <p><strong>File:</strong> <code class="language-plaintext highlighter-rouge">InlineAd.kt</code></p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">InlineAdViewModel</span><span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">adRequest</span> <span class="p">=</span> <span class="nc">AdRequest</span><span class="p">(</span><span class="s">"4810915"</span><span class="p">)</span>
    <span class="kd">var</span> <span class="py">advertisementState</span> <span class="p">=</span> <span class="n">mutableStateOf</span><span class="p">&lt;</span><span class="nc">ResultState</span><span class="p">&lt;</span><span class="nc">Advertisement</span><span class="p">&gt;?&gt;(</span><span class="k">null</span><span class="p">)</span>
    <span class="kd">var</span> <span class="py">aspectRatio</span> <span class="p">=</span> <span class="mf">2f</span>

    <span class="c1">// ...</span>

    <span class="nf">init</span> <span class="p">{</span>
        <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">tagUser</span> <span class="p">=</span> <span class="nf">async</span> <span class="p">{</span> <span class="nf">tagUser</span><span class="p">()</span> <span class="p">}</span>
            <span class="kd">val</span> <span class="py">conversionTracking</span> <span class="p">=</span> <span class="nf">async</span> <span class="p">{</span> <span class="nf">conversionTracking</span><span class="p">()</span> <span class="p">}</span>
            <span class="n">tagUser</span><span class="p">.</span><span class="nf">await</span><span class="p">()</span>
            <span class="n">conversionTracking</span><span class="p">.</span><span class="nf">await</span><span class="p">()</span>

            <span class="c1">// ...</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">tagUser</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">tags</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="nc">TagRequest</span><span class="p">.</span><span class="nc">Tag</span><span class="p">(</span><span class="s">"segments"</span><span class="p">,</span> <span class="s">"category"</span><span class="p">,</span> <span class="s">"home"</span><span class="p">))</span>
        <span class="kd">val</span> <span class="py">request</span> <span class="p">=</span> <span class="nc">TagRequest</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>

        <span class="nc">AdService</span><span class="p">.</span><span class="nf">tagUser</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="k">get</span><span class="p">(</span>
            <span class="n">onSuccess</span> <span class="p">=</span> <span class="p">{</span>
                <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"InlineAdViewModel"</span><span class="p">,</span> <span class="s">"User tagging was successful"</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="n">onError</span> <span class="p">=</span> <span class="p">{</span>
                <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"InlineAdViewModel"</span><span class="p">,</span> <span class="s">"Failed user tagging: ${it.description}"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">conversionTracking</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">request</span> <span class="p">=</span> <span class="nc">TrackingRequest</span><span class="p">(</span>
            <span class="n">landingPageId</span> <span class="p">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">trackingSpotId</span> <span class="p">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">orderId</span> <span class="p">=</span> <span class="s">"orderId"</span><span class="p">,</span>
            <span class="n">itemNumber</span> <span class="p">=</span> <span class="s">"itemNumber"</span><span class="p">,</span>
            <span class="n">description</span> <span class="p">=</span> <span class="s">"description"</span><span class="p">,</span>
            <span class="n">quantity</span> <span class="p">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">price</span> <span class="p">=</span> <span class="mf">19.99f</span><span class="p">,</span>
            <span class="n">total</span> <span class="p">=</span> <span class="mf">39.98f</span>
        <span class="p">)</span>

        <span class="nc">AdService</span><span class="p">.</span><span class="nf">trackingRequest</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="k">get</span><span class="p">(</span>
            <span class="n">onSuccess</span> <span class="p">=</span> <span class="p">{</span>
                <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"InlineAdViewModel"</span><span class="p">,</span> <span class="s">"Conversion tracking was successful"</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="n">onError</span> <span class="p">=</span> <span class="p">{</span>
                <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"InlineAdViewModel"</span><span class="p">,</span> <span class="s">"Failed conversion tracking: ${it.description}"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
